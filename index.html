<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>세상의 변화를 읽는 눈</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Quill.js CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Google Fonts - Noto Sans KR for Korean font support -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --coral-primary: #D96846;
            --coral-secondary: #E07A5F;
            --neutral-light: #CDCBD6;
            --plant-green: #596235;
            --dark-green: #2F3020;
            --color-bg-primary: var(--coral-primary);
            --color-bg-secondary: #FFFFFF;
            --color-text-primary: var(--dark-green);
            --color-text-secondary: var(--plant-green);
            --color-accent-primary: var(--dark-green);
            --color-accent-hover: var(--plant-green);
            --color-border: var(--neutral-light);
            --color-category-bg: var(--neutral-light);
            --color-category-text: var(--dark-green);
            --color-button-secondary-bg: var(--neutral-light);
            --color-button-secondary-text: var(--dark-green);
            --color-button-secondary-hover: #B0AEB9;
            --color-link-primary: var(--plant-green);
            --color-bg-animated-element: rgba(255, 255, 255, 0.15);
        }

        html.dark {
            --color-bg-primary: #2F3020;
            --color-bg-secondary: #404030;
            --color-text-primary: #d4d4d4;
            --color-text-secondary: #a0a0a0;
            --color-accent-primary: var(--coral-secondary);
            --color-accent-hover: var(--coral-primary);
            --color-border: #505040;
            --color-category-bg: #505040;
            --color-category-text: var(--coral-secondary);
            --color-button-secondary-bg: #505040;
            --color-button-secondary-text: #d4d4d4;
            --color-button-secondary-hover: #606050;
            --color-link-primary: var(--coral-secondary);
            --color-dark-category-item-bg: #3a3a3a;
            --color-dark-category-item-text: #f0f0f0;
            --color-bg-animated-element: rgba(205, 203, 214, 0.1);
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, var(--coral-primary) 0%, var(--coral-secondary) 100%);
            color: var(--color-text-primary);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        .bg-white { background-color: var(--color-bg-secondary); }
        .text-gray-800 { color: var(--color-text-primary); }
        .text-gray-500 { color: var(--color-text-secondary); }
        .text-gray-600 { color: var(--color-text-secondary); }
        header { border-color: var(--color-border); }
        .bg-white\/80 { background-color: rgba(255, 255, 255, 0.8); }
        html.dark .bg-white\/80 { background-color: rgba(45, 45, 45, 0.8); }
        .header-title-text { color: var(--color-accent-primary); }
        html.dark .header-title-text { color: var(--coral-secondary); }
        .hero-title-text { font-size: 32px; font-weight: bold; color: var(--color-text-primary); }
        .section-title-text { font-size: 24px; font-weight: 600; color: var(--color-text-primary); }
        .bg-\[\#4A55A2\] { background-color: var(--color-accent-primary); }
        .hover\:bg-\[\#3e4a8a\]:hover { background-color: var(--color-accent-hover); }
        .bg-gray-200 { background-color: var(--color-button-secondary-bg); }
        .text-gray-700 { color: var(--color-button-secondary-text); }
        .hover\:bg-gray-300:hover { background-color: var(--color-button-secondary-hover); }
        .bg-\[\#C5DFF8\] { background-color: var(--color-category-bg); }
        .text-\[\#4A55A2\] { color: var(--color-category-text); }
        .category-tab.active { background-color: var(--plant-green); color: white !important; border: 2px solid var(--plant-green); }
        html.dark .category-tab.active { background-color: var(--coral-secondary); color: var(--dark-green) !important; border-color: var(--coral-secondary); }
        .modal-content-anim { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .upload-progress-bar { background-color: var(--color-accent-primary); }
        html.dark .bg-gray-100 { background-color: var(--color-bg-secondary); }
        html.dark .border-gray-200 { border-color: var(--color-border); }
        html.dark .text-gray-400 { color: var(--color-text-secondary); }
        html.dark .text-gray-900 { color: var(--color-text-primary); }
        html.dark .hover\:text-\[\#7895CB\]:hover { color: var(--color-accent-primary); }
        html.dark .prose { color: var(--color-text-primary); }
        
        /* --- START: Quill Editor Universal Dark Style --- */
        .ql-toolbar { 
            background-color: #404030; 
            border-color: #505040 !important; 
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        .ql-container { 
            background-color: #404030; 
            border-color: #505040 !important; 
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
        }
        .ql-editor { 
            color: #FFFFFF; 
        }
        .ql-editor.ql-blank::before { 
            color: #a0a0a0; 
        }
        .ql-toolbar .ql-stroke { stroke: #d4d4d4; }
        .ql-toolbar .ql-fill { fill: #d4d4d4; }
        .ql-toolbar .ql-picker-label { color: #d4d4d4; }
        .ql-toolbar button:hover .ql-stroke, .ql-toolbar .ql-picker-label:hover { stroke: var(--coral-secondary); }
        .ql-toolbar button:hover .ql-fill { fill: var(--coral-secondary); }
        .ql-toolbar button:hover .ql-picker-label { color: var(--coral-secondary); }
        .ql-toolbar .ql-active .ql-stroke { stroke: var(--coral-primary); }
        .ql-toolbar .ql-active .ql-fill { fill: var(--coral-primary); }
        .ql-toolbar .ql-active .ql-picker-label { color: var(--coral-primary); }
        /* --- END: Quill Editor Universal Dark Style --- */

        html.dark .border { border-color: var(--color-border); }
        html.dark .file\:bg-blue-50 { background-color: var(--color-accent-primary); }
        html.dark .file\:text-blue-700 { color: var(--color-text-primary); }
        html.dark .hover\:file\:bg-blue-100:hover { background-color: var(--color-accent-hover); }
        html.dark .fas.fa-music, html.dark .fas.fa-video { color: var(--color-text-secondary); }
        html.dark .text-gray-500 { color: var(--color-text-secondary); }
        .theme-toggle-icon { font-size: 1.25rem; cursor: pointer; transition: color 0.3s ease; color: var(--color-text-primary); }
        .lang-btn { font-size: 1.152em; padding: 0.25rem 0.6rem; font-weight: bold; }
        .lang-btn:not(.active) { background-color: var(--color-button-secondary-bg); color: var(--color-button-secondary-text); border: 1px solid var(--color-border); }
        .lang-btn:not(.active):hover { background-color: var(--color-button-secondary-hover); }
        html.dark .header-title-text { color: var(--coral-secondary); }
        html.dark #category-list .flex.items-center.justify-between { background-color: var(--color-dark-category-item-bg); border-color: var(--color-border); }
        html.dark #category-list .category-name { color: var(--color-dark-category-item-text); }
        html.dark #category-list .edit-category-btn, html.dark #category-list .delete-category-btn { color: var(--color-text-secondary); }
        html.dark #category-list .edit-category-btn:hover, html.dark #category-list .delete-category-btn:hover { color: var(--color-text-primary); }
        .article-card, .media-item-card { box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; }
        html.dark .article-card, html.dark .media-item-card { box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .media-player-frame { padding: 1rem; background-color: var(--color-bg-secondary); border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid var(--color-border); }
        html.dark .media-player-frame { background-color: #252525; box-shadow: 0 2px 8px rgba(0,0,0,0.3); border-color: #333; }
        main section { padding-top: 80px; padding-bottom: 80px; }
        .introduction-content-wrapper, .prose { padding-left: 20px; padding-right: 20px; }
        @media (min-width: 768px) { .introduction-content-wrapper, .prose { padding-left: 40px; padding-right: 40px; } }
        #category-list, #media-list { max-height: 400px; overflow-y: auto; padding-right: 10px; }
        #category-list::-webkit-scrollbar, #media-list::-webkit-scrollbar { width: 8px; }
        #category-list::-webkit-scrollbar-track, #media-list::-webkit-scrollbar-track { background: var(--neutral-light); border-radius: 10px; }
        #category-list::-webkit-scrollbar-thumb, #media-list::-webkit-scrollbar-thumb { background: var(--plant-green); border-radius: 10px; }
        #category-list::-webkit-scrollbar-thumb:hover, #media-list::-webkit-scrollbar-thumb:hover { background: var(--dark-green); }
        #media-list { padding: 15px; border: 1px solid var(--color-border); border-radius: 8px; background: var(--color-bg-secondary); }
        #media-list::-webkit-scrollbar-thumb { background: linear-gradient(45deg, var(--plant-green), var(--dark-green)); }
        
        /* Animated Background Elements */
        .workspace-elements { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; }
        .object-base { position: absolute; animation: float 6s ease-in-out infinite; will-change: transform; }

        .ai-node {
            border-radius: 50%;
            background: radial-gradient(circle, var(--color-bg-animated-element) 0%, rgba(255,255,255,0) 70%);
            animation-name: float;
        }

        .ai-circuit-path {
            position: absolute;
            stroke: var(--color-bg-animated-element);
            stroke-width: 1;
            fill: none;
            stroke-dasharray: 200;
            stroke-dashoffset: 200;
            animation: draw-line 15s linear infinite;
        }

        @keyframes float { 
            0%, 100% { transform: translateY(0px); } 
            50% { transform: translateY(-20px); } 
        }

        @keyframes draw-line {
            to {
                stroke-dashoffset: -200;
            }
        }
        
        @media (max-width: 480px) {
            main section { padding-top: 40px; padding-bottom: 40px; } 
        }

        .modern-confirm-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; animation: fadeIn 0.3s ease-out; }
        .confirm-content { background-color: var(--color-bg-secondary); padding: 2rem; border-radius: 12px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); max-width: 400px; width: 90%; text-align: center; animation: slideUp 0.3s ease-out; }
        .confirm-content h3 { font-size: 1.5rem; font-weight: bold; color: var(--color-text-primary); margin-bottom: 1rem; }
        .confirm-content p { color: var(--color-text-secondary); margin-bottom: 1.5rem; }
        .confirm-buttons { display: flex; justify-content: center; gap: 1rem; }
        .btn-confirm, .btn-cancel { padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s ease-in-out; border: 1px solid transparent; }
        .btn-confirm { background-color: #ef4444; color: white; border-color: #ef4444; }
        .btn-confirm:hover { background-color: #dc2626; transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-cancel { background-color: var(--color-button-secondary-bg); color: var(--color-button-secondary-text); border-color: var(--color-border); }
        .btn-cancel:hover { background-color: var(--color-button-secondary-hover); transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1050; display: flex; flex-direction: column; gap: 10px; align-items: center; }
        .toast-message { background-color: rgba(0, 0, 0, 0.7); color: white; padding: 12px 20px; border-radius: 8px; font-size: 0.9rem; opacity: 0; transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; transform: translateY(20px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); min-width: 200px; text-align: center; }
        .toast-message.show { opacity: 1; transform: translateY(0); }
        .toast-message.success { background-color: #4CAF50; }
        .toast-message.error { background-color: #f44336; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; display:flex; align-items:center; justify-content:center; }
        .popup-content { position: relative; background: var(--color-bg-secondary); padding: 30px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); color: var(--color-text-primary); }
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 30px; cursor: pointer; color: var(--color-text-secondary); }
        .close-btn:hover { color: var(--color-text-primary); }
        .popup-content h2 { font-size: 1.8rem; font-weight: bold; margin-bottom: 15px; color: var(--color-accent-primary); }
        .popup-image { margin-bottom: 20px; text-align: center; }
        .popup-image img { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .popup-content-body { font-size: 1rem; line-height: 1.6; margin-bottom: 15px; color: var(--color-text-primary); }
        .popup-date { font-size: 0.85rem; color: var(--color-text-secondary); text-align: right; }
        .no-image-popup { background-color: var(--neutral-light); color: var(--dark-green); padding: 50px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 1.2rem; height: 200px; display: flex; align-items: center; justify-content: center; }
        .image-area { cursor: pointer; }
        .hidden { display: none; }
    </style>
</head>
<body class="text-gray-800">
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- React and ReactDOM from CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Quill.js Library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Babel for in-browser JSX/TS transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- The entire React Application in a single script tag -->
    <script type="text/babel">
        // All React hooks are available on the React object
        const { useState, useEffect, useCallback, useMemo, useRef } = React;

        // --- Start of types.ts (as plain objects/interfaces) ---
        // Since this isn't a true TS environment, `type` and `interface` keywords are effectively documentation.
        // They will be stripped by Babel but help with understanding the code structure.
        
        // --- Start of constants.ts ---
        const DEFAULT_ADMIN_PASSWORD = "admin";

        const I18N = {
            ko: { 
                headerTitle: "세상의 변화를 읽는 눈", 
                introductionTitle: "소개", 
                galleryTitle: "아티클 갤러리", all: "전체", readMore: "더보기", noArticlesText: "표시할 아티클이 없습니다.", 
                footerText: "© 2024 세상의 변화를 읽는 눈. All rights reserved.", 
                adminLogin: "관리자 로그인", logout: "로그아웃", newPost: "새 글 작성", edit: "수정", delete: "삭제", save: "저장", cancel: "취소", 
                category: "카테고리", password: "비밀번호", login: "로그인", deleteConfirm: "정말로 이 아티클을 삭제하시겠습니까?", error: "오류", 
                loginFailed: "비밀번호가 올바르지 않습니다.", accountSettings: "계정 설정", changePassword: "비밀번호 변경", 
                currentPassword: "현재 비밀번호", newPassword: "새 비밀번호", passwordChanged: "비밀번호가 성공적으로 변경되었습니다.", 
                passwordMismatch: "현재 비밀번호가 일치하지 않습니다.", editIntroduction: "소개 수정", manageCategories: "카테고리 관리",
                newCategory: "새 카테고리 이름", add: "추가", categoryInUse: "이 카테고리를 사용하는 게시물이 있어 삭제할 수 없습니다.",
                home: "홈으로", comments: "댓글", addComment: "댓글 달기", author: "작성자", commentContent: "댓글 내용...", submitComment: "등록", 
                deleteCommentConfirm: "이 댓글을 삭제하시겠습니까?", translate: "번역", reply: "답글 달기",
                mediaLibrary: "미디어 라이브러리", manageMedia: "미디어 관리", addMedia: "미디어 추가", editMedia: "미디어 수정",
                mediaTitle: "미디어 제목", mediaDescription: "미디어 설명", mediaFile: "미디어 파일", fileSizeLimit: "파일 크기 제한: 5MB",
                fileTooLarge: "파일이 너무 큽니다. 5MB 이하의 파일을 선택해주세요.",
                deleteMediaConfirm: "정말로 이 미디어를 삭제하시겠습니까?", saveAndTranslate: "저장 및 번역",
                translationError: "번역 오류 발생", confirm: "확인", deleteConfirmTitle: "삭제 확인",
                uploading: "업로드 중...", uploadComplete: "업로드 완료!", uploadFailed: "업로드 실패!",
                localStorageFull: "저장 공간이 부족합니다. 일부 미디어를 삭제하거나 브라우저 저장 공간을 늘려주세요.",
                manageIntroImages: "소개 이미지 관리", selectCategory: "카테고리를 선택하세요.",
                categoryAlreadyExists: "동일한 이름의 카테고리가 이미 존재합니다.", unauthorizedAccess: "관리자 권한이 필요합니다.",
                emptyCategoryName: "카테고리 이름을 입력해주세요.", emptyPostFields: "제목과 내용을 모두 입력해야 합니다.",
                emptyMediaFields: "미디어 제목과 설명을 입력해주세요.", emptyCommentFields: "작성자와 내용을 모두 입력해주세요.",
                deleteComplete: "삭제 완료!", deleteFailed: "삭제 실패!", saveComplete: "저장 완료!", saveFailed: "저장 실패!",
                commentAdded: "댓글이 추가되었습니다.", commentAddFailed: "댓글 추가 실패.", appLoadSuccess: "앱이 성공적으로 로드되었습니다!",
                appLoadFailed: "앱 로드 중 오류가 발생했습니다.", articleNotFound: "아티클을 찾을 수 없습니다.", noMediaText: "표시할 미디어가 없습니다.",
                editHeroText: "히어로 텍스트 수정",
                linkLibrary: "링크 라이브러리", manageLinks: "링크 관리", addLink: "링크 추가", editLink: "링크 수정",
                linkTitle: "링크 제목", linkDescription: "링크 설명", linkUrl: "URL", linkType: "타입",
                deleteLinkConfirm: "정말로 이 링크를 삭제하시겠습니까?", noLinksText: "표시할 링크가 없습니다.",
                emptyLinkFields: "제목, 설명 및 URL을 입력해주세요.",
                tags: "태그", manageTags: "태그 관리", newTag: "새 태그", addTag: "태그 추가", tagInUse: "이 태그를 사용하는 게시물이 있어 삭제할 수 없습니다.",
                searchPlaceholder: "검색...", searchResults: "검색 결과", noResultsFound: "검색 결과가 없습니다.",
                guestbook: "방명록", leaveMessage: "메시지 남기기", message: "메시지", noGuestbookEntries: "방명록에 글이 없습니다.",
                deleteGuestbookEntryConfirm: "정말로 이 방명록 글을 삭제하시겠습니까?",
                siteSettings: "사이트 설정", analyticsId: "Google Analytics ID", socialShare: "공유하기", copyLink: "링크 복사", linkCopied: "링크가 복사되었습니다!",
                deleteCategoryConfirm: "정말로 이 카테고리를 삭제하시겠습니까?",
                deleteTagConfirm: "정말로 이 태그를 삭제하시겠습니까?",
                deleteIntroImageConfirm: "정말로 이 이미지를 삭제하시겠습니까?",
                emptyNewPassword: "새 비밀번호를 입력해주세요.",
                selectFile: "파일을 선택해주세요.",
                tagAlreadyExists: "이미 존재하는 태그입니다.",
                featuredImage: "대표 이미지",
                youtubeVideoId: "유튜브 비디오 ID",
            },
            en: { 
                headerTitle: "The Eye to Read the World's Changes", 
                introductionTitle: "Introduction", 
                galleryTitle: "Article Gallery", all: "All", readMore: "Read More", noArticlesText: "No articles to display.", 
                footerText: "© 2024 The Eye to Read the World's Changes. All rights reserved.",
                adminLogin: "Admin Login", logout: "Logout", newPost: "New Post", edit: "Edit", delete: "Delete", save: "Save", cancel: "Cancel", 
                category: "Category", password: "Password", login: "Login", deleteConfirm: "Are you sure you want to delete this article?", error: "Error", 
                loginFailed: "Incorrect password.", accountSettings: "Account Settings", changePassword: "Change Password", 
                currentPassword: "Current Password", newPassword: "New Password", passwordChanged: "Password changed successfully.", 
                passwordMismatch: "Current password does not match.", editIntroduction: "Edit Intro", manageCategories: "Manage Categories",
                newCategory: "New category name", add: "Add", categoryInUse: "Cannot delete category as it is in use by one or more articles.",
                home: "Home", comments: "Comments", addComment: "Add a comment", author: "Author", commentContent: "Your comment...", submitComment: "Submit", 
                deleteCommentConfirm: "Are you sure you want to delete this comment?", translate: "Translate", reply: "Reply",
                mediaLibrary: "Media Library", manageMedia: "Media Manager", addMedia: "Add Media", editMedia: "Edit Media",
                mediaTitle: "Media Title", mediaDescription: "Media Description", mediaFile: "Media File", fileSizeLimit: "File size limit: 5MB",
                fileTooLarge: "File is too large. Please select a file smaller than 5MB.",
                deleteMediaConfirm: "Are you sure you want to delete this media?", saveAndTranslate: "Save & Translate",
                translationError: "Translation error occurred", confirm: "Confirm", deleteConfirmTitle: "Delete Confirmation",
                uploading: "Uploading...", uploadComplete: "Upload Complete!", uploadFailed: "Upload Failed!",
                localStorageFull: "Storage is full. Please delete some media or increase browser storage.",
                manageIntroImages: "Manage Intro Images", selectCategory: "Select a category.",
                categoryAlreadyExists: "A category with the same name already exists.", unauthorizedAccess: "Administrator privileges required.",
                emptyCategoryName: "Please enter a category name.", emptyPostFields: "Title and content must be entered for at least one language.",
                emptyMediaFields: "Please enter media title and description.", emptyCommentFields: "Please enter author and content.",
                deleteComplete: "Deletion Complete!", deleteFailed: "Deletion Failed!", saveComplete: "Save Complete!", saveFailed: "Save Failed!",
                commentAdded: "Comment added.", commentAddFailed: "Failed to add comment.", appLoadSuccess: "App loaded successfully!",
                appLoadFailed: "Error loading app.", articleNotFound: "Article not found.", noMediaText: "No media to display.",
                editHeroText: "Edit Hero Text",
                linkLibrary: "Link Library", manageLinks: "Manage Links", addLink: "Add Link", editLink: "Edit Link",
                linkTitle: "Link Title", linkDescription: "Link Description", linkUrl: "URL", linkType: "Type",
                deleteLinkConfirm: "Are you sure you want to delete this link?", noLinksText: "No links to display.",
                emptyLinkFields: "Please enter title, description, and URL.",
                tags: "Tags", manageTags: "Manage Tags", newTag: "New Tag", addTag: "Add Tag", tagInUse: "Cannot delete tag as it is in use.",
                searchPlaceholder: "Search...", searchResults: "Search Results", noResultsFound: "No results found.",
                guestbook: "Guestbook", leaveMessage: "Leave a Message", message: "Message", noGuestbookEntries: "No entries in the guestbook.",
                deleteGuestbookEntryConfirm: "Are you sure you want to delete this guestbook entry?",
                siteSettings: "Site Settings", analyticsId: "Google Analytics ID", socialShare: "Share", copyLink: "Copy Link", linkCopied: "Link copied!",
                deleteCategoryConfirm: "Are you sure you want to delete this category?",
                deleteTagConfirm: "Are you sure you want to delete this tag?",
                deleteIntroImageConfirm: "Are you sure you want to delete this image?",
                emptyNewPassword: "New password cannot be empty.",
                selectFile: "Please select a file.",
                tagAlreadyExists: "Tag already exists.",
                featuredImage: "Featured Image",
                youtubeVideoId: "YouTube Video ID",
            },
            vn: { 
                headerTitle: "Con mắt đọc vị những thay đổi của thế giới",
                introductionTitle: "Giới thiệu", 
                galleryTitle: "Thư viện bài viết", all: "Tất cả", readMore: "Đọc thêm", noArticlesText: "Không có bài viết nào để hiển thị.", 
                footerText: "© 2024 Con mắt đọc vị những thay đổi của thế giới. Mọi quyền được bảo lưu.",
                adminLogin: "Đăng nhập quản trị", logout: "Đăng xuất", newPost: "Bài viết mới", edit: "Sửa", delete: "Xóa", save: "Lưu", cancel: "Hủy", 
                category: "Danh mục", password: "Mật khẩu", login: "Đăng nhập", deleteConfirm: "Bạn có chắc chắn muốn xóa bài viết này không?", error: "Lỗi", 
                loginFailed: "Mật khẩu không đúng.", accountSettings: "Cài đặt tài khoản", changePassword: "Đổi mật khẩu", 
                currentPassword: "Mật khẩu hiện tại", newPassword: "Mật khẩu mới", passwordChanged: "Đổi mật khẩu thành công.", 
                passwordMismatch: "Mật khẩu hiện tại không khớp.", editIntroduction: "Sửa giới thiệu", manageCategories: "Quản lý danh mục",
                newCategory: "Tên danh mục mới", add: "Thêm", categoryInUse: "Không thể xóa danh mục vì nó đang được sử dụng bởi một hoặc nhiều bài viết.",
                home: "Trang chủ", comments: "Bình luận", addComment: "Thêm bình luận", author: "Tác giả", commentContent: "Bình luận của bạn...", submitComment: "Gửi", 
                deleteCommentConfirm: "Bạn có chắc chắn muốn xóa bình luận này không?", translate: "Dịch", reply: "Trả lời",
                mediaLibrary: "Thư viện Đa phương tiện", manageMedia: "Quản lý Đa phương tiện", addMedia: "Thêm Đa phương tiện", editMedia: "Sửa Đa phương tiện",
                mediaTitle: "Tiêu đề Đa phương tiện", mediaDescription: "Mô tả Đa phương tiện", mediaFile: "Tệp đa phương tiện", fileSizeLimit: "Giới hạn kích thước tệp: 5MB",
                fileTooLarge: "Tệp quá lớn. Vui lòng chọn tệp nhỏ hơn 5MB.",
                deleteMediaConfirm: "Bạn có chắc chắn muốn xóa phương tiện này không?", saveAndTranslate: "Lưu & Dịch",
                translationError: "Lỗi dịch", confirm: "Xác nhận", deleteConfirmTitle: "Xác nhận xóa",
                uploading: "Đang tải lên...", uploadComplete: "Tải lên hoàn tất!", uploadFailed: "Tải lên thất bại!",
                localStorageFull: "Dung lượng lưu trữ đã đầy. Vui lòng xóa một số phương tiện hoặc tăng dung lượng lưu trữ của trình duyệt.",
                manageIntroImages: "Quản lý hình ảnh giới thiệu", selectCategory: "Chọn một danh mục.",
                categoryAlreadyExists: "Một danh mục có cùng tên đã tồn tại.", unauthorizedAccess: "Yêu cầu quyền quản trị.",
                emptyCategoryName: "Vui lòng nhập tên danh mục.", emptyPostFields: "Tiêu đề và nội dung phải được nhập cho ít nhất một ngôn ngữ.",
                emptyMediaFields: "Vui lòng nhập tiêu đề và mô tả phương tiện.", emptyCommentFields: "Vui lòng nhập tác giả và nội dung.",
                deleteComplete: "Xóa thành công!", deleteFailed: "Xóa thất bại!", saveComplete: "Lưu thành công!", saveFailed: "Lưu thất bại!",
                commentAdded: "Đã thêm bình luận.", commentAddFailed: "Thêm bình luận thất bại.", noMediaText: "Không có phương tiện nào để hiển thị.",
                editHeroText: "Sửa văn bản Hero",
                appLoadSuccess: "Ứng dụng đã tải thành công!",
                appLoadFailed: "Lỗi khi tải ứng dụng.",
                linkLibrary: "Thư viện liên kết", manageLinks: "Quản lý liên kết", addLink: "Thêm liên kết", editLink: "Sửa liên kết",
                linkTitle: "Tiêu đề liên kết", linkDescription: "Mô tả liên kết", linkUrl: "URL", linkType: "Loại",
                deleteLinkConfirm: "Bạn có chắc chắn muốn xóa liên kết này không?", noLinksText: "Không có liên kết nào để hiển thị.",
                emptyLinkFields: "Vui lòng nhập tiêu đề, mô tả và URL.",
                tags: "Thẻ", manageTags: "Quản lý thẻ", newTag: "Thẻ mới", addTag: "Thêm thẻ", tagInUse: "Không thể xóa thẻ vì nó đang được sử dụng.",
                searchPlaceholder: "Tìm kiếm...", searchResults: "Kết quả tìm kiếm", noResultsFound: "Không tìm thấy kết quả.",
                guestbook: "Sổ lưu bút", leaveMessage: "Để lại lời nhắn", message: "Lời nhắn", noGuestbookEntries: "Chưa cóรายการใน sổ lưu bút.",
                deleteGuestbookEntryConfirm: "Bạn có chắc chắn muốn xóa mục sổ lưu bút này không?",
                siteSettings: "Cài đặt trang", analyticsId: "ID Google Analytics", socialShare: "Chia sẻ", copyLink: "Sao chép liên kết", linkCopied: "Đã sao chép liên kết!",
                deleteCategoryConfirm: "Bạn có chắc chắn muốn xóa danh mục này không?",
                deleteTagConfirm: "Bạn có chắc chắn muốn xóa thẻ này không?",
                deleteIntroImageConfirm: "Bạn có chắc chắn muốn xóa hình ảnh này không?",
                emptyNewPassword: "Mật khẩu mới không được để trống.",
                selectFile: "Vui lòng chọn một tập tin.",
                tagAlreadyExists: "Thẻ đã tồn tại.",
                featuredImage: "Hình ảnh nổi bật",
                youtubeVideoId: "ID video trên YouTube",
            }
        };

        const DEFAULT_HERO_CONTENT = {
            ko: {
                title: { text: "세상의 변화를 읽는 눈", color: "#2F3020", fontSize: "2.5rem" },
                subtitle: { text: "변화의 흐름 속에서 기회를 포착하고, 더 나은 미래를 준비하는 지혜를 나눕니다.", color: "#596235", fontSize: "1.25rem" }
            },
            en: {
                title: { text: "The Eye to Read the World's Changes", color: "#2F3020", fontSize: "2.5rem" },
                subtitle: { text: "Capturing opportunities in the flow of change and sharing wisdom to prepare for a better future.", color: "#596235", fontSize: "1.25rem" }
            },
            vn: {
                title: { text: "Con mắt đọc vị những thay đổi của thế giới", color: "#2F3020", fontSize: "2.5rem" },
                subtitle: { text: "Nắm bắt cơ hội trong dòng chảy của sự thay đổi và chia sẻ trí tuệ để chuẩn bị cho một tương lai tốt đẹp hơn.", color: "#596235", fontSize: "1.25rem" }
            }
        };

        const DEFAULT_INTRODUCTION = {
            ko: '<p>이곳에 자기소개 내용을 입력하세요. 이 웹사이트는 개인 포트폴리오, 블로그, 또는 정보 공유를 위한 공간으로 활용될 수 있습니다. 다양한 기능을 통해 여러분의 이야기를 효과적으로 전달해보세요.</p><p>새로운 아티클을 작성하고, 카테고리를 관리하며, 미디어를 추가하고, 심지어 소개 이미지까지 직접 관리할 수 있습니다. 관리자 모드에서 모든 기능을 제어할 수 있습니다.</p>',
            en: '<p>Enter your introduction content here. This website can be used as a personal portfolio, blog, or information sharing space. Effectively convey your story through various features.</p><p>You can write new articles, manage categories, add media, and even manage introduction images directly. All features can be controlled from the admin mode.</p>',
            vn: '<p>Nhập nội dung giới thiệu của bạn tại đây. Trang web này có thể được sử dụng làm danh mục cá nhân, blog hoặc không gian chia sẻ thông tin. Truyền tải câu chuyện của bạn một cách hiệu quả thông qua nhiều tính năng khác nhau.</p><p>Bạn có thể viết bài viết mới, quản lý danh mục, thêm phương tiện và thậm chí quản lý trực tiếp hình ảnh giới thiệu. Tất cả các tính năng có thể được kiểm soát từ chế độ quản trị.</p>'
        };

        const DEFAULT_ARTICLES = [
            { id: 'ai-1', category: 'ai', tags: ['ai', 'tech'], createdAt: Date.now(), comments: [], featuredImage: null, translations: { ko: { title: '생성형 AI의 부상', content: '<p>생성형 AI는 텍스트부터 이미지까지 새로운 콘텐츠 생성을 가능하게 하며 세상을 변화시키고 있습니다...</p>' }, en: { title: 'The Rise of Generative AI', content: '<p>Generative AI is transforming the world...</p>' }, vn: { title: 'Sự trỗi dậy của AI tạo sinh', content: '<p>AI tạo sinh đang thay đổi thế giới...</p>' } } },
            { id: 'seismic_engineering', category: 'seismic_engineering', tags: ['engineering'], createdAt: Date.now() - 10000, comments: [], featuredImage: null, translations: { ko: { title: '첨단 내진 보강 기술', content: '<p>내진 보강은 기존 구조물을 수정하여 지진 활동에 대한 저항력을 높이는 것을 포함합니다...</p>' }, en: { title: 'Advanced Seismic Retrofitting', content: '<p>Seismic retrofitting involves modifying existing structures...</p>' }, vn: { title: 'Cải tạo kháng chấn tiên tiến', content: '<p>Cải tạo kháng chấn bao gồm việc sửa đổi các cấu trúc hiện có...</p>' } } }
        ];

        const DEFAULT_CATEGORIES = [
            { id: 'ai', translations: { ko: 'AI', en: 'AI', vn: 'AI' } },
            { id: 'seismic_engineering', translations: { ko: '내진 공학', en: 'Seismic Engineering', vn: 'Kỹ thuật địa chấn' } },
            { id: 'korean_news', translations: { ko: '한국 뉴스', en: 'Korean News', vn: 'Tin tức Hàn Quốc' } }
        ];

        const DEFAULT_TAGS = [
            { id: 'ai', name: 'AI' },
            { id: 'tech', name: 'Tech' },
            { id: 'engineering', name: 'Engineering' }
        ];

        const DEFAULT_GUESTBOOK_ENTRIES = [
            { id: 'guest-1', author: '첫 방문자', message: '홈페이지가 멋지네요! 자주 방문하겠습니다.', createdAt: Date.now() }
        ];

        const DEFAULT_SITE_SETTINGS = {
            analyticsId: ''
        };

        const DEFAULT_MEDIA_ITEMS = [
            { id: 'media-1', type: 'video', url: 'https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', title: '샘플 비디오', description: '이것은 Big Buck Bunny 샘플 비디오입니다.' },
            { id: 'media-2', type: 'audio', url: 'https://storage.googleapis.com/gtv-videos-bucket/sample/SubaruOutback2010.mp4', title: '샘플 오디오', description: '이것은 샘플 오디오 파일입니다.' }
        ];
        
        const DEFAULT_LINK_ITEMS = [
            { id: 'link-1', type: 'link', url: 'https://www.google.com', title: '구글', description: '세계 최대 검색 엔진', createdAt: Date.now() },
            { id: 'link-2', type: 'youtube', url: 'M7lc1UVf-VE', title: 'lofi hip hop radio', description: '공부하거나 쉴 때 듣기 좋은 음악', createdAt: Date.now() - 10000 }
        ];

        const DEFAULT_INTRO_IMAGES = {
            image1: "https://picsum.photos/seed/image1/300/200",
            image2: "https://picsum.photos/seed/image2/300/200"
        };

        // --- Start of services/dataService.ts ---
        const getFromStorage = (key, defaultValue) => {
            try {
                const item = window.localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (error) {
                console.warn(`Error reading localStorage key “${key}”:`, error);
                return defaultValue;
            }
        };

        const setToStorage = (key, value) => {
            try {
                window.localStorage.setItem(key, JSON.stringify(value));
            } catch (error) {
                console.error(`Error setting localStorage key “${key}”:`, error);
                if (error instanceof DOMException && (error.name === 'QuotaExceededError' || error.name === 'NS_ERROR_DOM_QUOTA_REACHED')) {
                    alert("Local storage is full. Please clear some data.");
                }
                throw error;
            }
        };

        const loadInitialData = () => {
            const articles = getFromStorage('articles', []).length > 0 ? getFromStorage('articles', []) : DEFAULT_ARTICLES;
            const categories = getFromStorage('categories', []).length > 0 ? getFromStorage('categories', []) : DEFAULT_CATEGORIES;
            const tags = getFromStorage('tags', []).length > 0 ? getFromStorage('tags', []) : DEFAULT_TAGS;
            const mediaItems = getFromStorage('mediaItems', []).length > 0 ? getFromStorage('mediaItems', []) : DEFAULT_MEDIA_ITEMS;
            const linkItems = getFromStorage('linkItems', []).length > 0 ? getFromStorage('linkItems', []) : DEFAULT_LINK_ITEMS;
            const guestbookEntries = getFromStorage('guestbookEntries', []).length > 0 ? getFromStorage('guestbookEntries', []) : DEFAULT_GUESTBOOK_ENTRIES;
            const siteSettings = getFromStorage('siteSettings', DEFAULT_SITE_SETTINGS);
            const introImages = getFromStorage('introImages', DEFAULT_INTRO_IMAGES);
            const introductionContent = getFromStorage('introductionContent', DEFAULT_INTRODUCTION);
            let heroContent = getFromStorage('heroContent', DEFAULT_HERO_CONTENT);
            const adminPassword = getFromStorage('admin_password', 'admin');

            // Migration check for heroContent structure
            if (heroContent && heroContent.ko && typeof (heroContent.ko.title) === 'string') {
                console.warn('Old heroContent data structure found. Migrating to new structure by resetting to default.');
                heroContent = DEFAULT_HERO_CONTENT;
                setToStorage('heroContent', heroContent);
            }

            // Ensure all articles have a comments and tags array
            articles.forEach(a => { 
                if (!a.comments) a.comments = []; 
                if (!a.tags) a.tags = [];
            });
            
            return { articles, categories, tags, mediaItems, linkItems, guestbookEntries, siteSettings, introImages, introductionContent, heroContent, adminPassword };
        };

        const saveDataToStorage = (data) => {
            setToStorage('articles', data.articles.sort((a,b) => b.createdAt - a.createdAt));
            setToStorage('categories', data.categories.sort((a, b) => a.id.localeCompare(b.id)));
            setToStorage('tags', data.tags.sort((a,b) => a.name.localeCompare(b.name)));
            setToStorage('mediaItems', data.mediaItems);
            setToStorage('linkItems', data.linkItems.sort((a,b) => b.createdAt - a.createdAt));
            setToStorage('guestbookEntries', data.guestbookEntries.sort((a,b) => b.createdAt - a.createdAt));
            setToStorage('siteSettings', data.siteSettings);
            setToStorage('introImages', data.introImages);
            setToStorage('introductionContent', data.introductionContent);
            setToStorage('heroContent', data.heroContent);
        };

        const saveAdminPassword = (password) => {
            setToStorage('admin_password', password);
        };
        
        // --- Start of services/translationService.ts ---
        const translateText = async (text, targetLang) => {
            if (!text) return "";
            const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Network error: ${response.statusText}`);
                }
                const data = await response.json();
                return data[0]?.map((item) => item[0]).join('') || '';
            } catch (error) {
                console.error(`Translation error for text "${text}" to ${targetLang}:`, error);
                throw error;
            }
        };

        // --- Start of components ---
        
        const SpacetimeVisualization = () => {
            const mountRef = useRef(null);

            useEffect(() => {
                // Ensure component is mounted and THREE.js is loaded
                if (!mountRef.current || !window.THREE) return;

                const container = mountRef.current;
                let animationFrameId;

                // All Three.js variables
                let scene, camera, renderer, clock, controlsUpdater;
                let massMesh, gridMaterial;
                
                // Physical constants
                const GRID_SIZE = 50;
                const GRID_SCALE = 4;
                const MASS_STRENGTH = 0.8;
                const ANIMATION_SPEED = 0.5;

                // Initialize Scene
                function initScene() {
                    scene = new THREE.Scene();
                    scene.background = new THREE.Color(0x000511);
                    scene.fog = new THREE.Fog(0x000511, 5, 15);
                    
                    camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                    camera.position.set(0, 3, 6);
                    camera.lookAt(0, 0, 0);
                    
                    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                    renderer.setSize(container.clientWidth, container.clientHeight);
                    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                    
                    container.appendChild(renderer.domElement);
                }

                // Initialize Controls
                function initControls() {
                    let isMouseDown = false;
                    let mouseX = 0, mouseY = 0;
                    let targetRotationX = 0, targetRotationY = 0;
                    let rotationX = 0, rotationY = 0;

                    const onMouseDown = (event) => {
                        isMouseDown = true;
                        mouseX = event.clientX;
                        mouseY = event.clientY;
                    };

                    const onMouseMove = (event) => {
                        if (!isMouseDown) return;
                        const deltaX = event.clientX - mouseX;
                        const deltaY = event.clientY - mouseY;
                        targetRotationY += deltaX * 0.01;
                        targetRotationX += deltaY * 0.01;
                        mouseX = event.clientX;
                        mouseY = event.clientY;
                    };

                    const onMouseUp = () => isMouseDown = false;
                    
                    const onWheel = (event) => {
                        camera.position.multiplyScalar(event.deltaY > 0 ? 1.1 : 0.9);
                        camera.position.clampLength(3, 15);
                    };

                    renderer.domElement.addEventListener('mousedown', onMouseDown);
                    renderer.domElement.addEventListener('mousemove', onMouseMove);
                    renderer.domElement.addEventListener('mouseup', onMouseUp);
                    renderer.domElement.addEventListener('wheel', onWheel);

                    function updateControls() {
                        rotationX += (targetRotationX - rotationX) * 0.05;
                        rotationY += (targetRotationY - rotationY) * 0.05;
                        
                        const radius = camera.position.length();
                        camera.position.x = radius * Math.sin(rotationY) * Math.cos(rotationX);
                        camera.position.y = radius * Math.sin(rotationX);
                        camera.position.z = radius * Math.cos(rotationY) * Math.cos(rotationX);
                        camera.lookAt(0, 0, 0);
                    }
                    
                    return { 
                        update: updateControls, 
                        removeListeners: () => {
                            renderer.domElement.removeEventListener('mousedown', onMouseDown);
                            renderer.domElement.removeEventListener('mousemove', onMouseMove);
                            renderer.domElement.removeEventListener('mouseup', onMouseUp);
                            renderer.domElement.removeEventListener('wheel', onWheel);
                        }
                    };
                }

                // Create Grid
                function createGrid() {
                    const gridGeometry = new THREE.PlaneGeometry(GRID_SCALE, GRID_SCALE, GRID_SIZE - 1, GRID_SIZE - 1);
                    
                    gridMaterial = new THREE.ShaderMaterial({
                        uniforms: {
                            time: { value: 0 },
                            massPosition: { value: new THREE.Vector3(0, 0, 0) },
                            massStrength: { value: MASS_STRENGTH },
                            gridColor: { value: new THREE.Color(0x00C4FF) },
                            massNearColor: { value: new THREE.Color(0xFF4040) }
                        },
                        vertexShader: `
                            uniform vec3 massPosition;
                            uniform float massStrength;
                            varying float vDistanceToMass;
                            void main() {
                                vec3 worldPos = (modelMatrix * vec4(position, 1.0)).xyz;
                                float distance = length(worldPos - massPosition);
                                vDistanceToMass = distance;
                                float curvature = 0.0;
                                if (distance > 0.01) {
                                    curvature = massStrength / (distance * distance);
                                    if (distance < 0.2) curvature *= 5.0;
                                }
                                vec3 newPosition = position;
                                newPosition.z -= curvature * 0.5;
                                gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
                            }
                        `,
                        fragmentShader: `
                            uniform vec3 gridColor;
                            uniform vec3 massNearColor;
                            varying float vDistanceToMass;
                            void main() {
                                float colorMix = smoothstep(0.2, 0.5, vDistanceToMass);
                                vec3 finalColor = mix(massNearColor, gridColor, colorMix);
                                gl_FragColor = vec4(finalColor, 0.8);
                            }
                        `,
                        transparent: true,
                        side: THREE.DoubleSide,
                        wireframe: true
                    });
                    
                    const gridMesh = new THREE.Mesh(gridGeometry, gridMaterial);
                    gridMesh.rotation.x = -Math.PI / 2;
                    scene.add(gridMesh);
                }

                // Create Mass
                function createMass() {
                    const massGeometry = new THREE.SphereGeometry(0.1, 32, 32);
                    const massMaterial = new THREE.MeshPhongMaterial({ color: 0xFF4040, shininess: 100 });
                    massMesh = new THREE.Mesh(massGeometry, massMaterial);
                    scene.add(massMesh);
                }

                // Setup Lights
                function setupLights() {
                    scene.add(new THREE.AmbientLight(0x404040, 0.4));
                    const pointLight = new THREE.PointLight(0xffffff, 1, 100);
                    pointLight.position.set(2, 3, 2);
                    scene.add(pointLight);
                }

                // Animation Loop
                function animate() {
                    animationFrameId = requestAnimationFrame(animate);
                    const time = clock.getElapsedTime();
                    
                    massMesh.position.z = Math.sin(time * ANIMATION_SPEED * Math.PI) * 0.5;
                    
                    if (gridMaterial.uniforms) {
                        gridMaterial.uniforms.massPosition.value.copy(massMesh.position);
                    }
                    
                    controlsUpdater.update();
                    renderer.render(scene, camera);
                }

                // Handle Resize
                function handleResize() {
                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    camera.aspect = width / height;
                    camera.updateProjectionMatrix();
                    renderer.setSize(width, height);
                }

                // Initialization sequence
                function init() {
                    clock = new THREE.Clock();
                    initScene();
                    controlsUpdater = initControls();
                    createGrid();
                    createMass();
                    setupLights();
                    animate();
                    window.addEventListener('resize', handleResize);
                }

                init();

                // Cleanup
                return () => {
                    window.removeEventListener('resize', handleResize);
                    cancelAnimationFrame(animationFrameId);
                    controlsUpdater.removeListeners();
                    if (renderer) {
                        container.removeChild(renderer.domElement);
                    }
                    if (scene) {
                        scene.traverse(object => {
                            if (object.isMesh) {
                                if (object.geometry) object.geometry.dispose();
                                if (object.material) {
                                    if (Array.isArray(object.material)) {
                                        object.material.forEach(m => m.dispose());
                                    } else {
                                        object.material.dispose();
                                    }
                                }
                            }
                        });
                    }
                };
            }, []);

            return (
                <div ref={mountRef} className="w-full h-full rounded-lg shadow-md" style={{ minHeight: '250px', overflow: 'hidden' }}>
                    {/* Text overlay removed */}
                </div>
            );
        };

        const BackgroundElements = () => {
            return (
                <div className="workspace-elements">
                    <div className="object-base ai-node" style={{ top: '15%', left: '10%', animationDelay: '0s', width: '80px', height: '80px' }}></div>
                    <div className="object-base ai-node" style={{ top: '50%', left: '85%', animationDelay: '1s', width: '40px', height: '40px' }}></div>
                    <div className="object-base ai-node" style={{ top: '80%', left: '20%', animationDelay: '2s', width: '120px', height: '120px' }}></div>
                    <div className="object-base ai-node" style={{ top: '5%', right: '5%', animationDelay: '3s', width: '60px', height: '60px' }}></div>
                    <svg width="100%" height="100%" style={{ position: 'absolute', top: 0, left: 0, overflow: 'visible' }}>
                        <path className="ai-circuit-path" d="M -100,200 C 200,250 400,100 700,150 S 1000,250 1300,200 S 1600,100 2000,150" style={{ animationDelay: '0s' }} />
                        <path className="ai-circuit-path" d="M 2000,800 C 1800,700 1500,900 1200,850 S 800,750 500,800 S 200,900 -100,850" style={{ animationDelay: '-5s' }} />
                        <path className="ai-circuit-path" d="M -100,500 C 300,550 500,450 800,500 S 1100,550 1400,500 S 1700,450 2000,500" style={{ animationDelay: '-10s' }}/>
                    </svg>
                </div>
            );
        };
        
        const extractFirstImageFromHtml = (html) => {
            const doc = new DOMParser().parseFromString(html, 'text/html');
            const img = doc.querySelector('img');
            return img ? img.src : 'https://picsum.photos/seed/no-image/600/400';
        };

        const formatTimestamp = (timestamp) => {
            const date = new Date(timestamp);
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const dd = String(date.getDate()).padStart(2, '0');
            const h = String(date.getHours()).padStart(2, '0');
            const m = String(date.getMinutes()).padStart(2, '0');
            return `${yyyy}.${mm}.${dd} ${h}:${m}`;
        };

        const ArticleCard = ({ article, categories, tags, currentLanguage, isLoggedIn, onEdit, onDelete, onReadMore, readMoreText }) => {
            const translation = article.translations[currentLanguage] || article.translations.ko;
            const imageUrl = article.featuredImage || extractFirstImageFromHtml(translation.content);
            const categoryObj = categories.find(cat => cat.id === article.category);
            const displayCategoryName = categoryObj ? (categoryObj.translations[currentLanguage] || categoryObj.translations.ko) : article.category;
            const articleTags = (article.tags || []).map(tagId => tags.find(t => t.id === tagId)?.name).filter(Boolean);

            return (
                <div className="bg-white rounded-xl shadow-lg overflow-hidden border border-neutral-light transform hover:-translate-y-1 transition-transform duration-300 flex flex-col article-card dark:bg-gray-800 dark:border-gray-700">
                    <div className="relative image-area" onClick={() => onReadMore(article.id)}>
                        <img className="h-56 w-full object-cover" src={imageUrl} alt={translation.title} loading="lazy" />
                        {isLoggedIn && (
                            <div className="absolute top-2 right-2 flex space-x-2 z-10 pointer-events-auto">
                                <button onClick={(e) => {e.stopPropagation(); onEdit(article)}} className="edit-btn bg-plant-green text-white w-11 h-11 rounded-full hover:bg-dark-green flex items-center justify-center shadow-lg"><i className="fas fa-pencil-alt"></i></button>
                                <button onClick={(e) => {e.stopPropagation(); onDelete(article.id)}} className="delete-btn bg-red-500 text-white w-11 h-11 rounded-full hover:bg-red-600 flex items-center justify-center shadow-lg"><i className="fas fa-trash"></i></button>
                            </div>
                        )}
                    </div>
                    <div className="p-6 flex flex-col flex-grow">
                        <div className="flex justify-between items-center">
                            <span className="inline-block bg-neutral-light text-dark-green text-xs font-bold mr-2 px-3 py-1 rounded-full self-start dark:bg-gray-600 dark:text-gray-200">{displayCategoryName}</span>
                            <span className="text-xs text-gray-400 date">{formatTimestamp(article.createdAt)}</span>
                        </div>
                        <h3 className="mt-4 text-xl font-bold text-dark-green dark:text-white leading-snug">{translation.title}</h3>
                        {articleTags.length > 0 && (
                            <div className="mt-2 flex flex-wrap gap-2">
                                {articleTags.map(tagName => (
                                    <span key={tagName} className="text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded-full dark:bg-gray-600 dark:text-gray-300">#{tagName}</span>
                                ))}
                            </div>
                        )}
                        <div className="mt-auto pt-4">
                            <button onClick={() => onReadMore(article.id)} className="read-more-btn font-semibold text-plant-green hover:text-dark-green dark:text-coral-secondary dark:hover:text-coral-primary">
                                <span>{readMoreText}</span> <i className="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, children, maxWidth = 'max-w-4xl' }) => {
            if (!isOpen) return null;
            return (
                <div 
                    className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4"
                    onClick={onClose}
                >
                    <div
                        className={`modal-content-anim bg-white dark:bg-gray-800 w-full ${maxWidth} max-h-[90vh] rounded-2xl shadow-2xl flex flex-col`}
                        onClick={(e) => e.stopPropagation()}
                    >
                        {children}
                    </div>
                </div>
            );
        };

        const Toast = ({ toast, onDismiss }) => {
            const [visible, setVisible] = useState(false);
            useEffect(() => {
                setVisible(true);
                const timer = setTimeout(() => {
                    setVisible(false);
                    setTimeout(() => onDismiss(toast.id), 300);
                }, 3000);
                return () => clearTimeout(timer);
            }, [toast, onDismiss]);

            return (
                <div className={`toast-message ${toast.type} ${visible ? 'show' : ''}`}>
                    {toast.message}
                </div>
            );
        };

        const QuillEditor = ({ value, onChange, placeholder }) => {
            const quillRef = useRef(null);
            const quillInstance = useRef(null);
            const onChangeRef = useRef(onChange);

            useEffect(() => {
                onChangeRef.current = onChange;
            }, [onChange]);

            useEffect(() => {
                if (quillRef.current && !quillInstance.current && window.Quill) {
                    quillInstance.current = new window.Quill(quillRef.current, {
                        theme: 'snow',
                        modules: {
                            toolbar: [
                                [{ 'header': [1, 2, 3, false] }],
                                ['bold', 'italic', 'underline', 'strike'],
                                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                                ['link', 'image', 'video'],
                                ['clean']
                            ],
                        },
                        placeholder: placeholder,
                    });

                    quillInstance.current.on('text-change', (delta, oldDelta, source) => {
                        if (source === 'user') {
                            onChangeRef.current(quillInstance.current.root.innerHTML);
                        }
                    });
                }
            }, [placeholder]);

            useEffect(() => {
                if (quillInstance.current && quillInstance.current.root.innerHTML !== value) {
                    quillInstance.current.root.innerHTML = value;
                }
            }, [value]);

            return <div ref={quillRef} style={{ minHeight: '300px' }} />;
        };

        const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message, confirmText = 'Confirm', cancelText = 'Cancel' }) => {
            if (!isOpen) return null;
            return (
                <div className="modern-confirm-modal" onClick={onClose}>
                    <div className="confirm-content" onClick={(e) => e.stopPropagation()}>
                        <h3>{title}</h3>
                        <p>{message}</p>
                        <div className="confirm-buttons">
                            <button className="btn-cancel" onClick={onClose}>{cancelText}</button>
                            <button className="btn-confirm" onClick={onConfirm}>{confirmText}</button>
                        </div>
                    </div>
                </div>
            );
        };

        const CommentItem = ({ comment, allComments, onReply, currentLanguage, t }) => {
            const [showReply, setShowReply] = useState(false);
            const [replyAuthor, setReplyAuthor] = useState('');
            const [replyContent, setReplyContent] = useState('');
            const nestedComments = allComments.filter(c => c.parentId === comment.id);

            const handleReplySubmit = (e) => {
                e.preventDefault();
                onReply(comment.id, replyAuthor, replyContent);
                setReplyAuthor('');
                setReplyContent('');
                setShowReply(false);
            };

            return (
                <div className="ml-4 pl-4 border-l border-gray-200 dark:border-gray-700 py-2">
                    <p className="font-semibold">{comment.author}</p>
                    <p className="text-sm text-gray-600 dark:text-gray-400">{comment.content}</p>
                    <p className="text-xs text-gray-400 dark:text-gray-500 mt-1">{new Date(comment.createdAt).toLocaleString()}</p>
                    <button onClick={() => setShowReply(!showReply)} className="text-xs text-blue-500 hover:underline mt-1">{t.reply}</button>
                    {showReply && (
                        <form onSubmit={handleReplySubmit} className="mt-2 space-y-2">
                            <input type="text" value={replyAuthor} onChange={e => setReplyAuthor(e.target.value)} placeholder={t.author} required className="w-full text-sm p-1 border rounded dark:bg-gray-600 dark:text-white" />
                            <textarea value={replyContent} onChange={e => setReplyContent(e.target.value)} placeholder={t.commentContent} required rows={2} className="w-full text-sm p-1 border rounded dark:bg-gray-600 dark:text-white"></textarea>
                            <button type="submit" className="px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600">{t.submitComment}</button>
                        </form>
                    )}
                    {nestedComments.map(reply => (
                        <CommentItem key={reply.id} comment={reply} allComments={allComments} onReply={onReply} currentLanguage={currentLanguage} t={t} />
                    ))}
                </div>
            );
        };

        const PopupModal = ({ article, currentLanguage, onClose, onAddComment, onAddReply, t, showToast }) => {
            const [newCommentAuthor, setNewCommentAuthor] = useState('');
            const [newCommentContent, setNewCommentContent] = useState('');
            
            if (!article) return null;

            const translation = article.translations[currentLanguage] || article.translations.ko;
            const imageUrl = article.featuredImage || extractFirstImageFromHtml(translation.content);
            const rootComments = (article.comments || []).filter(comment => !comment.parentId);

            const handleCommentSubmit = (e) => {
                e.preventDefault();
                if (!newCommentAuthor.trim() || !newCommentContent.trim()) {
                    showToast(t.emptyCommentFields, 'error');
                    return;
                }
                onAddComment(article.id, newCommentAuthor, newCommentContent);
                setNewCommentAuthor('');
                setNewCommentContent('');
            };

            const handleReply = (parentId, author, content) => {
                if (!author.trim() || !content.trim()) {
                    showToast(t.emptyCommentFields, 'error');
                    return;
                }
                onAddReply(article.id, parentId, author, content);
            };

            const handleShare = (platform) => {
                const url = window.location.href;
                const title = translation.title;
                let shareUrl = '';

                switch(platform) {
                    case 'facebook':
                        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                        break;
                    case 'twitter':
                        shareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`;
                        break;
                    case 'linkedin':
                        shareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`;
                        break;
                    case 'copy':
                        navigator.clipboard.writeText(url).then(() => {
                            showToast(t.linkCopied, 'success');
                        });
                        return;
                }
                window.open(shareUrl, '_blank', 'noopener,noreferrer');
            };

            return (
                <div className="popup-overlay" onClick={onClose}>
                    <div className="popup-content" onClick={(e) => e.stopPropagation()}>
                        <span className="close-btn" onClick={onClose}>&times;</span>
                        <h2 id="popupTitle">{translation.title}</h2>
                        <div id="popupImage" className="popup-image">
                            {imageUrl ? (
                                <img src={imageUrl} alt={translation.title} loading="lazy" />
                            ) : (
                                <div className="no-image-popup">No Image</div>
                            )}
                        </div>
                        <div
                            id="popupContent"
                            className="popup-content-body prose max-w-none dark:prose-invert"
                            dangerouslySetInnerHTML={{ __html: translation.content }}
                        ></div>
                        <div id="popupDate" className="popup-date">{formatTimestamp(article.createdAt)}</div>
                        <div className="mt-8 border-t pt-4 dark:border-gray-700">
                             <h3 className="font-semibold mb-2">{t.socialShare}</h3>
                             <div className="flex items-center gap-2">
                                <button onClick={() => handleShare('facebook')} className="w-10 h-10 flex items-center justify-center rounded-full bg-blue-600 text-white hover:bg-blue-700"><i className="fab fa-facebook-f"></i></button>
                                <button onClick={() => handleShare('twitter')} className="w-10 h-10 flex items-center justify-center rounded-full bg-blue-400 text-white hover:bg-blue-500"><i className="fab fa-twitter"></i></button>
                                <button onClick={() => handleShare('linkedin')} className="w-10 h-10 flex items-center justify-center rounded-full bg-blue-800 text-white hover:bg-blue-900"><i className="fab fa-linkedin-in"></i></button>
                                <button onClick={() => handleShare('copy')} className="w-10 h-10 flex items-center justify-center rounded-full bg-gray-500 text-white hover:bg-gray-600"><i className="fas fa-link"></i></button>
                             </div>
                        </div>
                        <div id="modal-comments-section" className="mt-8 border-t pt-4 dark:border-gray-700">
                            <h3 className="font-semibold mb-4">{t.comments} ({(article.comments || []).length})</h3>
                            <form onSubmit={handleCommentSubmit} className="mb-6 space-y-2">
                                <input type="text" value={newCommentAuthor} onChange={e => setNewCommentAuthor(e.target.value)} placeholder={t.author} required className="w-full p-2 border rounded dark:bg-gray-600 dark:text-white" />
                                <textarea value={newCommentContent} onChange={e => setNewCommentContent(e.target.value)} placeholder={t.commentContent} required rows={3} className="w-full p-2 border rounded dark:bg-gray-600 dark:text-white"></textarea>
                                <button type="submit" className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">{t.submitComment}</button>
                            </form>
                            <div className="space-y-4">
                                {rootComments.map(comment => (
                                    <CommentItem key={comment.id} comment={comment} allComments={article.comments} onReply={handleReply} currentLanguage={currentLanguage} t={t} />
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Analytics = ({ trackingId }) => {
            useEffect(() => {
                if (!trackingId) return;

                const script1 = document.createElement('script');
                script1.src = `https://www.googletagmanager.com/gtag/js?id=${trackingId}`;
                script1.async = true;
                document.head.appendChild(script1);

                const script2 = document.createElement('script');
                script2.innerHTML = `
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', '${trackingId}');
                `;
                document.head.appendChild(script2);

                return () => {
                    document.head.removeChild(script1);
                    document.head.removeChild(script2);
                };
            }, [trackingId]);

            return null;
        };

        const App = () => {
            // State declarations
            const [articles, setArticles] = useState([]);
            const [categories, setCategories] = useState([]);
            const [tags, setTags] = useState([]);
            const [mediaItems, setMediaItems] = useState([]);
            const [linkItems, setLinkItems] = useState([]);
            const [guestbookEntries, setGuestbookEntries] = useState([]);
            const [siteSettings, setSiteSettings] = useState({ analyticsId: '' });
            const [introImages, setIntroImages] = useState({ image1: '', image2: '' });
            const [introductionContent, setIntroductionContent] = useState({ ko: '', en: '', vn: '' });
            const [heroContent, setHeroContent] = useState(DEFAULT_HERO_CONTENT);
            const [adminPassword, setAdminPassword] = useState(DEFAULT_ADMIN_PASSWORD);
            const [currentLanguage, setCurrentLanguage] = useState('ko');
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [theme, setTheme] = useState('light');
            const [currentCategoryFilter, setCurrentCategoryFilter] = useState('all');
            const [currentTagFilter, setCurrentTagFilter] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');
            const [activeModal, setActiveModal] = useState(null);
            const [editingArticle, setEditingArticle] = useState(null);
            const [editingMedia, setEditingMedia] = useState(null);
            const [editingLink, setEditingLink] = useState(null);
            const [confirmProps, setConfirmProps] = useState(null);
            const [toasts, setToasts] = useState([]);
            const [selectedArticle, setSelectedArticle] = useState(null);
            const [searchResults, setSearchResults] = useState(null);
            
            // Form states
            const [loginPassword, setLoginPassword] = useState('');
            const [showLoginPassword, setShowLoginPassword] = useState(false);
            const [accountPasswords, setAccountPasswords] = useState({ current: '', new: '' });
            const [showCurrentPassword, setShowCurrentPassword] = useState(false);
            const [showNewPassword, setShowNewPassword] = useState(false);
            const [newCategoryName, setNewCategoryName] = useState('');
            const [newTagName, setNewTagName] = useState('');
            const [guestbookForm, setGuestbookForm] = useState({author: '', message: ''});
            const [introContentForm, setIntroContentForm] = useState({ ko: '', en: '', vn: ''});
            const [heroContentForm, setHeroContentForm] = useState(DEFAULT_HERO_CONTENT);
            const [siteSettingsForm, setSiteSettingsForm] = useState({analyticsId: ''});
            const [postForm, setPostForm] = useState({ category: '', tags: '', featuredImage: null, translations: { ko: {title: '', content: ''}, en: {title: '', content: ''}, vn: {title: '', content: ''}}});
            const [mediaForm, setMediaForm] = useState({ type: 'video', title: '', description: '', file: null, url: '' });
            const [linkForm, setLinkForm] = useState({ type: 'link', title: '', description: '', url: '' });
            const [introImageFiles, setIntroImageFiles] = useState({ file1: null, file2: null});
            
            const t = useMemo(() => I18N[currentLanguage], [currentLanguage]);

            const showToast = (message, type = 'info') => {
                setToasts(prev => [...prev, { id: Date.now(), message, type }]);
            };

            const handleDataSave = useCallback(() => {
                try {
                    saveDataToStorage({ articles, categories, tags, mediaItems, linkItems, guestbookEntries, siteSettings, introImages, introductionContent, heroContent });
                } catch (e) {
                    showToast(t.localStorageFull, 'error');
                }
            }, [articles, categories, tags, mediaItems, linkItems, guestbookEntries, siteSettings, introImages, introductionContent, heroContent, t]);

            useEffect(() => {
                const data = loadInitialData();
                setArticles(data.articles);
                setCategories(data.categories);
                setTags(data.tags);
                setMediaItems(data.mediaItems);
                setLinkItems(data.linkItems);
                setGuestbookEntries(data.guestbookEntries);
                setSiteSettings(data.siteSettings);
                setIntroImages(data.introImages);
                setIntroductionContent(data.introductionContent);
                setHeroContent(data.heroContent);
                setAdminPassword(data.adminPassword);

                const savedTheme = localStorage.getItem('theme');
                if (savedTheme) {
                    setTheme(savedTheme);
                    document.documentElement.classList.toggle('dark', savedTheme === 'dark');
                }

                const loggedIn = sessionStorage.getItem('isLoggedIn') === 'true';
                setIsLoggedIn(loggedIn);

                const handleKeyDown = (e) => {
                    if (e.ctrlKey && e.altKey && e.key === 'a') {
                        setActiveModal('login');
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

            useEffect(() => {
                if (articles.length > 0) { // Only save when there's data to avoid overwriting on initial load
                    handleDataSave();
                }
            }, [articles, categories, tags, mediaItems, linkItems, guestbookEntries, siteSettings, introImages, introductionContent, heroContent, handleDataSave]);

            const toggleTheme = () => {
                const newTheme = theme === 'light' ? 'dark' : 'light';
                setTheme(newTheme);
                document.documentElement.classList.toggle('dark', newTheme === 'dark');
                localStorage.setItem('theme', newTheme);
            };

            const handleLogin = (e) => {
                e.preventDefault();
                if (loginPassword === adminPassword) {
                    setIsLoggedIn(true);
                    sessionStorage.setItem('isLoggedIn', 'true');
                    setActiveModal(null);
                    setLoginPassword('');
                    setShowLoginPassword(false);
                    showToast('Login successful', 'success');
                } else {
                    showToast(t.loginFailed, 'error');
                }
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                sessionStorage.removeItem('isLoggedIn');
            };
            
            const handlePasswordChange = (e) => {
                e.preventDefault();
                if (accountPasswords.current !== adminPassword) {
                    showToast(t.passwordMismatch, 'error');
                    return;
                }
                if (!accountPasswords.new) {
                    showToast(t.emptyNewPassword, 'error');
                    return;
                }
                saveAdminPassword(accountPasswords.new);
                setAdminPassword(accountPasswords.new);
                showToast(t.passwordChanged, 'success');
                setActiveModal(null);
                setAccountPasswords({ current: '', new: '' });
                setShowCurrentPassword(false);
                setShowNewPassword(false);
            };

            const handleAddCategory = async (e) => {
                e.preventDefault();
                if (!newCategoryName.trim()) {
                    showToast(t.emptyCategoryName, 'error');
                    return;
                }
                const slugify = (text) => text.toLowerCase().replace(/[^a-z0-9_\\uAC00-\\uD7A3]+/g, '_').replace(/_+/g, '_').replace(/^_|_$/g, '');
                const newCatId = slugify(newCategoryName);

                if (categories.some(c => c.id === newCatId)) {
                    showToast(t.categoryAlreadyExists, 'error');
                    return;
                }
                
                try {
                    const translatedEn = await translateText(newCategoryName, 'en');
                    const translatedVn = await translateText(newCategoryName, 'vn');
                    const newCategory = {
                        id: newCatId,
                        translations: { ko: newCategoryName, en: translatedEn, vn: translatedVn }
                    };
                    setCategories(prev => [...prev, newCategory]);
                    setNewCategoryName('');
                    showToast(t.saveComplete, 'success');
                } catch {
                    showToast(t.translationError, 'error');
                }
            };

            const handleDeleteCategory = (id) => {
                if (articles.some(article => article.category === id)) {
                    showToast(t.categoryInUse, 'error');
                    return;
                }
                setConfirmProps({
                    title: t.deleteConfirmTitle,
                    message: t.deleteCategoryConfirm,
                    onConfirm: () => {
                        setCategories(prev => prev.filter(c => c.id !== id));
                        setConfirmProps(null);
                        showToast(t.deleteComplete, 'success');
                    }
                });
            };

            const handleAddTag = (e) => {
                e.preventDefault();
                const trimmed = newTagName.trim();
                if (!trimmed) return;
                const slug = trimmed.toLowerCase().replace(/\s+/g, '-');
                if (tags.some(t => t.id === slug)) {
                    showToast(t.tagAlreadyExists, 'error');
                    return;
                }
                setTags(prev => [...prev, { id: slug, name: trimmed }]);
                setNewTagName('');
            };
            
            const handleDeleteTag = (id) => {
                if (articles.some(article => (article.tags || []).includes(id))) {
                    showToast(t.tagInUse, 'error');
                    return;
                }
                setConfirmProps({
                    title: t.deleteConfirmTitle,
                    message: t.deleteTagConfirm,
                    onConfirm: () => {
                        setTags(prev => prev.filter(t => t.id !== id));
                        setConfirmProps(null);
                        showToast(t.deleteComplete, 'success');
                    }
                });
            };

            const handleIntroductionSave = (e) => {
                e.preventDefault();
                setIntroductionContent(introContentForm);
                showToast(t.saveComplete, 'success');
                setActiveModal(null);
            };
            
            const handleHeroContentSave = (e) => {
                e.preventDefault();
                setHeroContent(heroContentForm);
                showToast(t.saveComplete, 'success');
                setActiveModal(null);
            };

            const handleSiteSettingsSave = (e) => {
                e.preventDefault();
                setSiteSettings(siteSettingsForm);
                showToast(t.saveComplete, 'success');
                setActiveModal(null);
            };

            const handlePostSave = async (e) => {
                e.preventDefault();
                const contentData = postForm.translations;
                const sourceLang = ['ko', 'en', 'vn'].find(lang => contentData[lang].title.trim() && contentData[lang].content.trim() && contentData[lang].content.trim() !== '<p><br></p>');
                
                if (!postForm.category || !sourceLang) {
                    showToast(t.emptyPostFields, 'error');
                    return;
                }

                // Process tags
                const postTags = postForm.tags.split(',').map(tag => tag.trim().toLowerCase().replace(/\s+/g, '-')).filter(Boolean);
                const newTags = postTags.filter(tagId => !tags.some(t => t.id === tagId));
                if (newTags.length > 0) {
                    setTags(prev => [...prev, ...newTags.map(tagId => ({ id: tagId, name: tagId }))]);
                }

                try {
                    const finalTranslations = { ...contentData };
                    for (const lang of ['ko', 'en', 'vn']) {
                        if (lang !== sourceLang) {
                            if (!finalTranslations[lang].title.trim()) {
                                finalTranslations[lang].title = await translateText(contentData[sourceLang].title, lang);
                            }
                            if (!finalTranslations[lang].content.trim() || finalTranslations[lang].content.trim() === '<p><br></p>') {
                                const textToTranslate = contentData[sourceLang].content.replace(/<[^>]+>/g, ' ');
                                const translatedText = await translateText(textToTranslate, lang);
                                finalTranslations[lang].content = `<p>${translatedText}</p>`;
                            }
                        }
                    }
                    
                    const articleData = {
                        category: postForm.category,
                        tags: postTags,
                        featuredImage: postForm.featuredImage,
                        translations: finalTranslations,
                    };

                    if (editingArticle) {
                        setArticles(articles.map(a => a.id === editingArticle.id ? {...a, ...articleData} : a));
                    } else {
                        const newArticle = { id: `article-${Date.now()}`, createdAt: Date.now(), ...articleData, comments: [] };
                        setArticles(prev => [newArticle, ...prev]);
                    }
                    showToast(t.saveComplete, 'success');
                    setActiveModal(null);
                } catch {
                    showToast(t.translationError, 'error');
                }
            };
            
            const handleDeleteArticle = (id) => {
                setConfirmProps({
                    title: t.deleteConfirmTitle,
                    message: t.deleteConfirm,
                    onConfirm: () => {
                        setArticles(prev => prev.filter(a => a.id !== id));
                        setConfirmProps(null);
                        showToast(t.deleteComplete, 'success');
                    }
                });
            };

            const openPostForm = (article) => {
                setEditingArticle(article);
                if (article) {
                    const tagString = (article.tags || []).map(tagId => tags.find(t => t.id === tagId)?.name || tagId).join(', ');
                    setPostForm({ category: article.category, tags: tagString, featuredImage: article.featuredImage || null, translations: article.translations });
                } else {
                    setPostForm({ category: '', tags: '', featuredImage: null, translations: { ko: {title: '', content: ''}, en: {title: '', content: ''}, vn: {title: '', content: ''}}});
                }
                setActiveModal('postForm');
            };
            
            const fileToBase64 = (file) => {
                return new Promise((resolve, reject) => {
                    if (file.size > 5 * 1024 * 1024) {
                        reject(new Error(t.fileTooLarge));
                        return;
                    }
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });
            };

            const handleMediaSave = async (e) => {
                e.preventDefault();
                const { title, description, file } = mediaForm;
                if (!title.trim() || !description.trim()) {
                    showToast(t.emptyMediaFields, 'error');
                    return;
                }
                if (!file && !editingMedia) {
                    showToast(t.selectFile, 'error');
                    return;
                }

                try {
                    let fileUrl = editingMedia?.url;
                    if (file) {
                        fileUrl = await fileToBase64(file);
                    }
                    
                    const mediaData = {
                        type: mediaForm.type,
                        title: mediaForm.title,
                        description: mediaForm.description,
                        url: fileUrl
                    };

                    if (editingMedia) {
                        setMediaItems(mediaItems.map(m => m.id === editingMedia.id ? {...m, ...mediaData } : m));
                    } else {
                        setMediaItems(prev => [...prev, { id: `media-${Date.now()}`, ...mediaData }]);
                    }

                    showToast(t.saveComplete, 'success');
                    setActiveModal('mediaManager'); // Return to manager
                    setEditingMedia(null);

                } catch(error) {
                    if (error instanceof Error) {
                        showToast(error.message, 'error');
                    } else {
                        showToast(t.uploadFailed, 'error');
                    }
                }
            };

            const handleDeleteMedia = (id) => {
                setConfirmProps({
                    title: t.deleteConfirmTitle,
                    message: t.deleteMediaConfirm,
                    onConfirm: () => {
                        setMediaItems(prev => prev.filter(m => m.id !== id));
                        setConfirmProps(null);
                        showToast(t.deleteComplete, 'success');
                    }
                });
            };
            
            const openMediaForm = (media) => {
                setEditingMedia(media);
                if (media) {
                    setMediaForm({ type: media.type, title: media.title, description: media.description, file: null, url: media.url });
                } else {
                    setMediaForm({ type: 'video', title: '', description: '', file: null, url: '' });
                }
                setActiveModal('mediaForm');
            };

            const handleLinkSave = async (e) => {
                e.preventDefault();
                const { title, description, url, type } = linkForm;
                if (!title.trim() || !description.trim() || !url.trim()) {
                    showToast(t.emptyLinkFields, 'error');
                    return;
                }
                
                let finalUrl = url;
                if(type === 'youtube') {
                    const videoIdMatch = url.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
                    finalUrl = videoIdMatch ? videoIdMatch[1] : url;
                }

                if (editingLink) {
                    setLinkItems(linkItems.map(l => l.id === editingLink.id ? {...l, ...linkForm, url: finalUrl, createdAt: l.createdAt } : l));
                } else {
                    const newLink = { id: `link-${Date.now()}`, createdAt: Date.now(), ...linkForm, url: finalUrl };
                    setLinkItems(prev => [newLink, ...prev]);
                }
                showToast(t.saveComplete, 'success');
                setActiveModal('linkManager'); // Return to manager
                setEditingLink(null);
            };

            const handleDeleteLink = (id) => {
                setConfirmProps({
                    title: t.deleteConfirmTitle,
                    message: t.deleteLinkConfirm,
                    onConfirm: () => {
                        setLinkItems(prev => prev.filter(l => l.id !== id));
                        setConfirmProps(null);
                        showToast(t.deleteComplete, 'success');
                    }
                });
            };

            const openLinkForm = (link) => {
                setEditingLink(link);
                if (link) {
                    setLinkForm({ type: link.type, title: link.title, description: link.description, url: link.url });
                } else {
                    setLinkForm({ type: 'link', title: '', description: '', url: '' });
                }
                setActiveModal('linkForm');
            };

            const handleSaveIntroImages = async () => {
                try {
                    const newImages = { ...introImages };
                    if (introImageFiles.file1) {
                        newImages.image1 = await fileToBase64(introImageFiles.file1);
                    }
                    if (introImageFiles.file2) {
                        newImages.image2 = await fileToBase64(introImageFiles.file2);
                    }
                    setIntroImages(newImages);
                    showToast(t.saveComplete, 'success');
                    setActiveModal(null);
                } catch (error) {
                    if (error instanceof Error) {
                        showToast(error.message, 'error');
                    } else {
                        showToast(t.uploadFailed, 'error');
                    }
                }
            };
            
            const handleDeleteIntroImage = (imageNumber) => {
                 setConfirmProps({
                    title: t.deleteConfirmTitle,
                    message: t.deleteIntroImageConfirm,
                    onConfirm: () => {
                        setIntroImages(prev => ({...prev, [`image${imageNumber}`]: `https://picsum.photos/seed/image${imageNumber}/300/200`}));
                        setConfirmProps(null);
                        showToast(t.deleteComplete, 'success');
                    }
                });
            };

            const handleFeaturedImageChange = async (e) => {
                if (e.target.files && e.target.files[0]) {
                    try {
                        const file = e.target.files[0];
                        const base64 = await fileToBase64(file);
                        setPostForm(p => ({ ...p, featuredImage: base64 }));
                    } catch (error) {
                        if (error instanceof Error) {
                            showToast(error.message, 'error');
                        }
                    }
                }
            };
            
            const handleDeleteFeaturedImage = () => {
                setPostForm(p => ({...p, featuredImage: null}));
            };

            const handleAddComment = (articleId, author, content) => {
                const newComment = {
                    id: `comment-${Date.now()}`,
                    author,
                    content,
                    createdAt: Date.now(),
                    parentId: null
                };
                setArticles(prev => prev.map(a => a.id === articleId ? { ...a, comments: [...(a.comments || []), newComment] } : a));
                showToast(t.commentAdded, 'success');
            };

            const handleAddReply = (articleId, parentId, author, content) => {
                 const newComment = {
                    id: `comment-${Date.now()}`,
                    author,
                    content,
                    createdAt: Date.now(),
                    parentId: parentId
                };
                setArticles(prev => prev.map(a => a.id === articleId ? { ...a, comments: [...(a.comments || []), newComment] } : a));
                showToast(t.commentAdded, 'success');
            };

            const handleGuestbookSubmit = (e) => {
                e.preventDefault();
                const {author, message} = guestbookForm;
                if(!author.trim() || !message.trim()) {
                    showToast(t.emptyCommentFields, 'error');
                    return;
                }
                const newEntry = {
                    id: `guest-${Date.now()}`,
                    author,
                    message,
                    createdAt: Date.now()
                };
                setGuestbookEntries(prev => [newEntry, ...prev]);
                setGuestbookForm({author: '', message: ''});
                showToast(t.saveComplete, 'success');
            };
            
            const handleDeleteGuestbookEntry = (id) => {
                 setConfirmProps({
                    title: t.deleteConfirmTitle,
                    message: t.deleteGuestbookEntryConfirm,
                    onConfirm: () => {
                        setGuestbookEntries(prev => prev.filter(e => e.id !== id));
                        setConfirmProps(null);
                        showToast(t.deleteComplete, 'success');
                    }
                });
            };
            
            const handleSearch = (e) => {
                e.preventDefault();
                const term = searchTerm.toLowerCase();
                if (!term) {
                    setSearchResults(null);
                    return;
                }
                const articleResults = articles.filter(a => 
                    (a.translations[currentLanguage] || a.translations.ko).title.toLowerCase().includes(term) ||
                    (a.translations[currentLanguage] || a.translations.ko).content.toLowerCase().includes(term)
                );
                const mediaResults = mediaItems.filter(m => 
                    m.title.toLowerCase().includes(term) || 
                    m.description.toLowerCase().includes(term)
                );
                const linkResults = linkItems.filter(l => 
                    l.title.toLowerCase().includes(term) || 
                    l.description.toLowerCase().includes(term)
                );
                setSearchResults({ articles: articleResults, media: mediaResults, links: linkResults });
                setActiveModal('searchResults');
            };

            const filteredArticles = useMemo(() => {
                return articles
                    .filter(a => currentCategoryFilter === 'all' || a.category === currentCategoryFilter)
                    .filter(a => currentTagFilter === 'all' || (a.tags || []).includes(currentTagFilter));
            }, [articles, currentCategoryFilter, currentTagFilter]);
            
            const inputStyles = "w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-plant-green bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder:text-gray-400 dark:placeholder:text-gray-500";
            const textareaStyles = `${inputStyles} resize-y`;
            const adminMenuButtonClasses = "w-full text-left flex items-center gap-3 px-3 py-2 rounded-md text-sm font-semibold text-white hover:bg-gray-700";
            const adminMenuLogoutButtonClasses = "w-full text-left flex items-center gap-3 px-3 py-2 rounded-md text-sm font-semibold text-red-400 hover:bg-gray-700";
            const modalTitleClasses = "text-2xl font-bold text-gray-900 dark:text-white";
            const modalSectionTitleClasses = "text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3";
            const modalButtonPrimaryClasses = "w-full bg-dark-green text-white py-2.5 rounded-lg font-semibold hover:bg-plant-green transition-colors dark:bg-coral-primary dark:hover:bg-coral-secondary";
            const modalButtonSecondaryClasses = "w-full bg-gray-200 text-gray-700 py-2.5 rounded-lg font-semibold hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 transition-colors";

            return (
                <div className={`text-gray-800 ${theme}`}>
                    <Analytics trackingId={siteSettings.analyticsId} />
                    <BackgroundElements />

                    <header className="bg-white/80 backdrop-blur-lg sticky top-0 z-40 border-b border-gray-200 dark:bg-gray-800/80 dark:border-gray-700">
                        <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex items-center justify-between h-20">
                                <div className="flex items-center space-x-3">
                                    <div className="w-10 h-10 bg-plant-green flex items-center justify-center rounded-lg text-white"><i className="fas fa-eye"></i></div>
                                    <span className="text-xl font-bold header-title-text">{t.headerTitle}</span>
                                    <button onClick={toggleTheme} className="theme-toggle-icon ml-4">
                                        <i className={`fas ${theme === 'dark' ? 'fa-sun' : 'fa-moon'}`}></i>
                                    </button>
                                </div>
                                <div className="flex items-center space-x-4">
                                     <form onSubmit={handleSearch} className="relative">
                                        <input 
                                            type="search" 
                                            value={searchTerm}
                                            onChange={e => setSearchTerm(e.target.value)}
                                            placeholder={t.searchPlaceholder} 
                                            className={`${inputStyles} h-10 pr-10`}
                                        />
                                        <button type="submit" className="absolute inset-y-0 right-0 px-3 text-gray-500"><i className="fas fa-search"></i></button>
                                    </form>
                                    <div className="flex items-center space-x-1 bg-neutral-light p-1 rounded-full dark:bg-gray-700">
                                        {['ko', 'en', 'vn'].map(lang => (
                                            <button key={lang} onClick={() => setCurrentLanguage(lang)}
                                                className={`lang-btn px-4 py-2 rounded-full font-bold transition-all duration-300 ${currentLanguage === lang ? 'active' : ''}`}>
                                                {lang.toUpperCase()}
                                            </button>
                                        ))}
                                    </div>
                                     {isLoggedIn && (
                                        <details className="relative">
                                            <summary className="bg-neutral-light text-dark-green px-3 py-2 rounded-full text-sm font-semibold hover:bg-plant-green hover:text-white transition-colors cursor-pointer list-none flex items-center dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-coral-primary">
                                                <i className="fas fa-cogs mr-1"></i>
                                                <span>Admin</span>
                                                <i className="fas fa-chevron-down ml-1 text-xs"></i>
                                            </summary>
                                            <div className="absolute right-0 mt-2 w-56 bg-gray-800 rounded-md shadow-lg z-50 p-2 space-y-1">
                                                 <button onClick={() => setCurrentCategoryFilter('all')} className={adminMenuButtonClasses}><i className="fas fa-home w-5 text-center"></i><span>{t.home}</span></button>
                                                 <button onClick={() => { setHeroContentForm(heroContent); setActiveModal('heroForm'); }} className={adminMenuButtonClasses}><i className="fas fa-heading w-5 text-center"></i><span>{t.editHeroText}</span></button>
                                                 <button onClick={() => { setIntroContentForm(introductionContent); setActiveModal('introForm'); }} className={adminMenuButtonClasses}><i className="fas fa-id-card w-5 text-center"></i><span>{t.editIntroduction}</span></button>
                                                 <button onClick={() => setActiveModal('introImage')} className={adminMenuButtonClasses}><i className="fas fa-image w-5 text-center"></i><span>{t.manageIntroImages}</span></button>
                                                 <button onClick={() => setActiveModal('linkManager')} className={adminMenuButtonClasses}><i className="fas fa-link w-5 text-center"></i><span>{t.manageLinks}</span></button>
                                                 <button onClick={() => setActiveModal('mediaManager')} className={adminMenuButtonClasses}><i className="fas fa-photo-video w-5 text-center"></i><span>{t.manageMedia}</span></button>
                                                 <button onClick={() => setActiveModal('categoryManager')} className={adminMenuButtonClasses}><i className="fas fa-sitemap w-5 text-center"></i><span>{t.manageCategories}</span></button>
                                                 <button onClick={() => setActiveModal('tagManager')} className={adminMenuButtonClasses}><i className="fas fa-tags w-5 text-center"></i><span>{t.manageTags}</span></button>
                                                 <button onClick={() => { setSiteSettingsForm(siteSettings); setActiveModal('siteSettings'); }} className={adminMenuButtonClasses}><i className="fas fa-cog w-5 text-center"></i><span>{t.siteSettings}</span></button>
                                                 <button onClick={() => setActiveModal('account')} className={adminMenuButtonClasses}><i className="fas fa-user-cog w-5 text-center"></i><span>{t.accountSettings}</span></button>
                                                 <hr className="my-1 border-gray-600"/>
                                                 <button onClick={handleLogout} className={adminMenuLogoutButtonClasses}><i className="fas fa-sign-out-alt w-5 text-center"></i><span>{t.logout}</span></button>
                                            </div>
                                        </details>
                                    )}
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-12 relative z-10">
                        <section className="text-center mb-16">
                            <h1 style={{
                                color: heroContent[currentLanguage]?.title.color,
                                fontSize: heroContent[currentLanguage]?.title.fontSize,
                                fontWeight: 'bold',
                                letterSpacing: '-0.025em'
                            }} className="dark:text-white">
                                {heroContent[currentLanguage]?.title.text}
                            </h1>
                            <p style={{
                                color: heroContent[currentLanguage]?.subtitle.color,
                                fontSize: heroContent[currentLanguage]?.subtitle.fontSize,
                                marginTop: '1rem',
                            }}
                            className="max-w-2xl mx-auto dark:text-gray-300"
                            >
                                {heroContent[currentLanguage]?.subtitle.text}
                            </p>
                        </section>
                        
                        <section className="bg-white p-8 md:p-12 rounded-xl shadow-lg border border-gray-100 flex flex-col md:flex-row md:space-x-8 dark:bg-gray-800 dark:border-gray-700">
                            <div className="md:w-2/3 w-full introduction-content-wrapper">
                                 <div className="max-w-none text-gray-600 dark:text-gray-300 space-y-5 leading-relaxed text-left md:text-justify text-base prose dark:prose-invert" dangerouslySetInnerHTML={{ __html: introductionContent[currentLanguage] }}></div>
                            </div>
                             <div className="md:w-1/3 w-full mt-8 md:mt-0 flex flex-col justify-center items-center space-y-4 relative">
                                <img src={introImages.image1} alt="Introduction 1" className="rounded-lg shadow-md w-full h-auto object-cover" loading="lazy" />
                                <SpacetimeVisualization />
                            </div>
                        </section>
                        
                        <section id="link-library-section" className="bg-white p-8 md:p-12 rounded-xl shadow-lg border border-gray-100 mt-20 dark:bg-gray-800 dark:border-gray-700">
                            <div className="flex justify-center items-center mb-8"><h2 className="section-title-text text-center dark:text-white">{t.linkLibrary}</h2></div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {linkItems.map(item => (
                                    <div key={item.id} className="bg-white dark:bg-gray-700 rounded-xl shadow-lg overflow-hidden border border-neutral-light dark:border-gray-600 p-4 flex flex-col justify-start text-left media-item-card">
                                        {item.type === 'youtube' ? (
                                            <div className="w-full aspect-video mb-4">
                                                <iframe 
                                                    className="w-full h-full rounded-md"
                                                    src={`https://www.youtube.com/embed/${item.url}`}
                                                    title={item.title} 
                                                    frameBorder="0" 
                                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                                    allowFullScreen
                                                    loading="lazy">
                                                </iframe>
                                            </div>
                                        ) : (
                                            <div className="flex items-center gap-4 mb-4">
                                                <i className="fas fa-link text-3xl text-plant-green dark:text-coral-primary"></i>
                                                <a href={item.url} target="_blank" rel="noopener noreferrer" className="text-lg font-semibold text-dark-green dark:text-gray-100 hover:text-plant-green dark:hover:text-coral-primary break-all">
                                                    {item.title}
                                                </a>
                                            </div>
                                        )}
                                        <h3 className="text-lg font-semibold text-dark-green dark:text-gray-100 mb-2">{item.title}</h3>
                                        <p className="text-sm text-gray-600 dark:text-gray-300 flex-grow">{item.description}</p>
                                        {item.type === 'link' && (
                                             <a href={item.url} target="_blank" rel="noopener noreferrer" className="text-sm text-blue-500 hover:underline mt-2 self-start truncate w-full">
                                                {item.url}
                                            </a>
                                        )}
                                    </div>
                                ))}
                                {linkItems.length === 0 && <p className="col-span-full text-center text-gray-500 dark:text-gray-400">{t.noLinksText}</p>}
                            </div>
                        </section>

                        <section className="bg-white p-8 md:p-12 rounded-xl shadow-lg border border-gray-100 mt-20 dark:bg-gray-800 dark:border-gray-700">
                            <div className="flex justify-center items-center mb-8"><h2 className="section-title-text text-center dark:text-white">{t.mediaLibrary}</h2></div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {mediaItems.map(item => (
                                    <div key={item.id} className="bg-white dark:bg-gray-700 rounded-xl shadow-lg overflow-hidden border border-neutral-light dark:border-gray-600 p-4 flex flex-col items-center justify-center text-center media-item-card">
                                        {item.type === 'video' ? (
                                            <video controls src={item.url} className="w-full h-48 object-cover rounded-md mb-4 bg-black"></video>
                                        ) : (
                                            <audio controls src={item.url} className="w-full mb-4"></audio>
                                        )}
                                        <h3 className="text-lg font-semibold text-dark-green dark:text-gray-100 mb-2">{item.title}</h3>
                                        <p className="text-sm text-gray-600 dark:text-gray-300">{item.description}</p>
                                    </div>
                                ))}
                                {mediaItems.length === 0 && <p className="col-span-full text-center text-gray-500 dark:text-gray-400">{t.noMediaText}</p>}
                            </div>
                        </section>

                        <section className="bg-white p-8 md:p-12 rounded-xl shadow-lg border border-gray-100 mt-20 dark:bg-gray-800 dark:border-gray-700">
                            <div className="flex justify-center items-center mb-4">
                                <h2 className="section-title-text text-center dark:text-white">{t.galleryTitle}</h2>
                                {isLoggedIn && <button onClick={() => openPostForm(null)} className="ml-4 bg-green-500 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-green-600 transition-colors"><i className="fas fa-plus mr-2"></i><span>{t.newPost}</span></button>}
                            </div>
                            <div className="flex justify-center flex-wrap gap-3 mb-2">
                                <span className="font-semibold dark:text-white">{t.category}:</span>
                                <button onClick={() => setCurrentCategoryFilter('all')} className={`px-3 py-1 text-sm font-semibold rounded-full transition-all duration-300 category-tab ${currentCategoryFilter === 'all' ? 'active' : 'bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600'}`}>{t.all}</button>
                                {categories.map(cat => (
                                    <button key={cat.id} onClick={() => setCurrentCategoryFilter(cat.id)} className={`px-3 py-1 text-sm font-semibold rounded-full transition-all duration-300 category-tab ${currentCategoryFilter === cat.id ? 'active' : 'bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600'}`}>
                                        {cat.translations[currentLanguage] || cat.translations.ko}
                                    </button>
                                ))}
                            </div>
                             <div className="flex justify-center flex-wrap gap-3 mb-8">
                                <span className="font-semibold dark:text-white">{t.tags}:</span>
                                <button onClick={() => setCurrentTagFilter('all')} className={`px-3 py-1 text-sm font-semibold rounded-full transition-all duration-300 category-tab ${currentTagFilter === 'all' ? 'active' : 'bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600'}`}>{t.all}</button>
                                {tags.map(tag => (
                                    <button key={tag.id} onClick={() => setCurrentTagFilter(tag.id)} className={`px-3 py-1 text-sm font-semibold rounded-full transition-all duration-300 category-tab ${currentTagFilter === tag.id ? 'active' : 'bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600'}`}>
                                        {tag.name}
                                    </button>
                                ))}
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                {filteredArticles.map(article => (
                                    <ArticleCard key={article.id} article={article} categories={categories} tags={tags} currentLanguage={currentLanguage} isLoggedIn={isLoggedIn} onEdit={openPostForm} onDelete={handleDeleteArticle} onReadMore={(id) => setSelectedArticle(articles.find(a => a.id === id) || null)} readMoreText={t.readMore} />
                                ))}
                            </div>
                            {filteredArticles.length === 0 && <div className="text-center py-16 text-gray-500 dark:text-gray-400"><i className="fas fa-box-open text-4xl mb-4"></i><p>{t.noArticlesText}</p></div>}
                        </section>

                        <section id="guestbook" className="bg-white p-8 md:p-12 rounded-xl shadow-lg border border-gray-100 mt-20 dark:bg-gray-800 dark:border-gray-700">
                            <div className="flex justify-center items-center mb-8"><h2 className="section-title-text text-center dark:text-white">{t.guestbook}</h2></div>
                            <div className="max-w-2xl mx-auto">
                                <form onSubmit={handleGuestbookSubmit} className="space-y-4 mb-8">
                                    <input type="text" value={guestbookForm.author} onChange={e => setGuestbookForm(p => ({...p, author: e.target.value}))} placeholder={t.author} required className={inputStyles} />
                                    <textarea value={guestbookForm.message} onChange={e => setGuestbookForm(p => ({...p, message: e.target.value}))} placeholder={t.message} required rows={4} className={textareaStyles}></textarea>
                                    <button type="submit" className="bg-dark-green text-white px-6 py-2 rounded-lg font-semibold hover:bg-plant-green dark:bg-coral-primary dark:hover:bg-coral-secondary">{t.leaveMessage}</button>
                                </form>
                                <div className="space-y-4">
                                    {guestbookEntries.map(entry => (
                                        <div key={entry.id} className="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg relative">
                                            <p className="font-semibold dark:text-white">{entry.author}</p>
                                            <p className="text-gray-700 dark:text-gray-300">{entry.message}</p>
                                            <p className="text-xs text-gray-400 mt-2">{new Date(entry.createdAt).toLocaleString()}</p>
                                            {isLoggedIn && <button onClick={() => handleDeleteGuestbookEntry(entry.id)} className="absolute top-2 right-2 text-red-500 hover:text-red-700"><i className="fas fa-trash"></i></button>}
                                        </div>
                                    ))}
                                    {guestbookEntries.length === 0 && <p className="text-center text-gray-500 dark:text-gray-400">{t.noGuestbookEntries}</p>}
                                </div>
                            </div>
                        </section>
                    </main>
                    
                    <footer className="border-t border-gray-200 dark:border-gray-700 mt-16">
                        <div className="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-gray-500 dark:text-gray-400">
                            <p>{t.footerText}</p>
                        </div>
                    </footer>
                    
                    {/* Modals are rendered here */}
                    <Modal isOpen={activeModal === 'login'} onClose={() => setActiveModal(null)} maxWidth="max-w-sm">
                         <div className="flex justify-between items-center mb-6 p-8 pb-0">
                            <h2 className={modalTitleClasses}>{t.adminLogin}</h2>
                            <button onClick={() => setActiveModal(null)} className="text-gray-400 hover:text-gray-800 dark:hover:text-white transition-colors"><i className="fas fa-times text-xl"></i></button>
                        </div>
                        <form onSubmit={handleLogin} className="space-y-4 p-8 pt-4">
                            <div className="relative">
                                <input 
                                    type={showLoginPassword ? 'text' : 'password'} 
                                    value={loginPassword} 
                                    onChange={(e) => setLoginPassword(e.target.value)} 
                                    placeholder={t.password} 
                                    required 
                                    className={inputStyles}
                                />
                                <button 
                                    type="button" 
                                    onClick={() => setShowLoginPassword(!showLoginPassword)}
                                    className="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"
                                >
                                    <i className={`fas ${showLoginPassword ? 'fa-eye-slash' : 'fa-eye'}`}></i>
                                </button>
                            </div>
                            <button type="submit" className={modalButtonPrimaryClasses}>{t.login}</button>
                        </form>
                    </Modal>

                    <Modal isOpen={activeModal === 'account'} onClose={() => setActiveModal(null)} maxWidth="max-w-sm">
                        <div className="flex justify-between items-center mb-6 p-8 pb-0">
                            <h2 className={modalTitleClasses}>{t.accountSettings}</h2>
                            <button onClick={() => setActiveModal(null)} className="text-gray-400 hover:text-gray-800 dark:hover:text-white transition-colors"><i className="fas fa-times text-xl"></i></button>
                        </div>
                        <form onSubmit={handlePasswordChange} className="space-y-4 p-8 pt-4">
                            <div className="relative">
                                <input 
                                    value={accountPasswords.current} 
                                    onChange={e => setAccountPasswords(p => ({...p, current: e.target.value}))} 
                                    type={showCurrentPassword ? 'text' : 'password'}
                                    placeholder={t.currentPassword} 
                                    required 
                                    className={inputStyles}
                                />
                                 <button 
                                    type="button" 
                                    onClick={() => setShowCurrentPassword(!showCurrentPassword)}
                                    className="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"
                                >
                                    <i className={`fas ${showCurrentPassword ? 'fa-eye-slash' : 'fa-eye'}`}></i>
                                </button>
                            </div>
                            <div className="relative">
                                <input 
                                    value={accountPasswords.new} 
                                    onChange={e => setAccountPasswords(p => ({...p, new: e.target.value}))} 
                                    type={showNewPassword ? 'text' : 'password'}
                                    placeholder={t.newPassword} 
                                    required 
                                    className={inputStyles}
                                />
                                 <button 
                                    type="button" 
                                    onClick={() => setShowNewPassword(!showNewPassword)}
                                    className="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"
                                >
                                    <i className={`fas ${showNewPassword ? 'fa-eye-slash' : 'fa-eye'}`}></i>
                                </button>
                            </div>
                            <button type="submit" className={modalButtonPrimaryClasses}>{t.changePassword}</button>
                        </form>
                    </Modal>
                    
                    <Modal isOpen={activeModal === 'categoryManager'} onClose={() => setActiveModal(null)} maxWidth="max-w-lg">
                        <div className="p-8 space-y-6">
                            <h2 className={modalTitleClasses}>{t.manageCategories}</h2>
                            <div className="space-y-2 max-h-60 overflow-y-auto pr-2">
                                {categories.map(cat => (
                                    <div key={cat.id} className="flex justify-between items-center p-2 bg-gray-100 dark:bg-gray-700 rounded">
                                        <span>{cat.translations[currentLanguage] || cat.translations.ko}</span>
                                        <button onClick={() => handleDeleteCategory(cat.id)} className="text-red-500 hover:text-red-700"><i className="fas fa-trash"></i></button>
                                    </div>
                                ))}
                            </div>
                            <form onSubmit={handleAddCategory} className="flex gap-2">
                                <input type="text" value={newCategoryName} onChange={e => setNewCategoryName(e.target.value)} placeholder={t.newCategory} className={inputStyles} />
                                <button type="submit" className="px-4 py-2 bg-dark-green text-white rounded-lg font-semibold hover:bg-plant-green dark:bg-coral-primary dark:hover:bg-coral-secondary">{t.add}</button>
                            </form>
                        </div>
                    </Modal>

                    <Modal isOpen={activeModal === 'tagManager'} onClose={() => setActiveModal(null)} maxWidth="max-w-lg">
                        <div className="p-8 space-y-6">
                            <h2 className={modalTitleClasses}>{t.manageTags}</h2>
                            <div className="space-y-2 max-h-60 overflow-y-auto pr-2">
                                {tags.map(tag => (
                                    <div key={tag.id} className="flex justify-between items-center p-2 bg-gray-100 dark:bg-gray-700 rounded">
                                        <span>{tag.name}</span>
                                        <button onClick={() => handleDeleteTag(tag.id)} className="text-red-500 hover:text-red-700"><i className="fas fa-trash"></i></button>
                                    </div>
                                ))}
                            </div>
                            <form onSubmit={handleAddTag} className="flex gap-2">
                                <input type="text" value={newTagName} onChange={e => setNewTagName(e.target.value)} placeholder={t.newTag} className={inputStyles} />
                                <button type="submit" className="px-4 py-2 bg-dark-green text-white rounded-lg font-semibold hover:bg-plant-green dark:bg-coral-primary dark:hover:bg-coral-secondary">{t.addTag}</button>
                            </form>
                        </div>
                    </Modal>
                    
                    <Modal isOpen={activeModal === 'introForm'} onClose={() => setActiveModal(null)} maxWidth="max-w-4xl">
                        <div className="p-8 space-y-6 overflow-y-auto">
                            <h2 className={modalTitleClasses}>{t.editIntroduction}</h2>
                            <form onSubmit={handleIntroductionSave} className="space-y-4">
                                {['ko', 'en', 'vn'].map(lang => (
                                    <div key={lang} className="p-4 border rounded-lg dark:border-gray-600">
                                        <h3 className="font-bold mb-2 text-white">{lang.toUpperCase()}</h3>
                                        <QuillEditor value={introContentForm[lang]} onChange={content => setIntroContentForm(p => ({...p, [lang]: content}))} placeholder={`${t.introductionTitle} (${lang})`} />
                                    </div>
                                ))}
                                <div className="flex justify-end gap-4 pt-4">
                                    <button type="button" onClick={() => setActiveModal(null)} className={modalButtonSecondaryClasses}>{t.cancel}</button>
                                    <button type="submit" className={modalButtonPrimaryClasses}>{t.save}</button>
                                </div>
                            </form>
                        </div>
                    </Modal>
                    
                    <Modal isOpen={activeModal === 'heroForm'} onClose={() => setActiveModal(null)} maxWidth="max-w-4xl">
                        <div className="p-8 space-y-6 overflow-y-auto">
                            <h2 className={modalTitleClasses}>{t.editHeroText}</h2>
                            <form onSubmit={handleHeroContentSave} className="space-y-4">
                                {['ko', 'en', 'vn'].map(lang => (
                                    <div key={lang} className="p-4 border rounded-lg dark:border-gray-600 space-y-4">
                                        <h3 className="font-bold mb-2 text-white">{lang.toUpperCase()}</h3>
                                        
                                        {/* Title Section */}
                                        <div className="p-3 border border-gray-500 rounded-md">
                                            <label className="block text-sm font-medium text-gray-300 mb-2">Title</label>
                                            <input type="text" value={heroContentForm[lang].title.text} onChange={e => setHeroContentForm(p => ({...p, [lang]: {...p[lang], title: {...p[lang].title, text: e.target.value}}}))} className={inputStyles} />
                                            <div className="flex items-center gap-4 mt-2">
                                                <div>
                                                    <label className="block text-xs text-gray-400">Font Size</label>
                                                    <input type="text" value={heroContentForm[lang].title.fontSize} onChange={e => setHeroContentForm(p => ({...p, [lang]: {...p[lang], title: {...p[lang].title, fontSize: e.target.value}}}))} className={`${inputStyles} w-24`} />
                                                </div>
                                                <div>
                                                    <label className="block text-xs text-gray-400">Color</label>
                                                    <input type="color" value={heroContentForm[lang].title.color} onChange={e => setHeroContentForm(p => ({...p, [lang]: {...p[lang], title: {...p[lang].title, color: e.target.value}}}))} className="w-24 h-10 p-1 bg-gray-700 border border-gray-500 rounded-lg cursor-pointer" />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Subtitle Section */}
                                        <div className="p-3 border border-gray-500 rounded-md">
                                            <label className="block text-sm font-medium text-gray-300 mb-2">Subtitle</label>
                                            <input type="text" value={heroContentForm[lang].subtitle.text} onChange={e => setHeroContentForm(p => ({...p, [lang]: {...p[lang], subtitle: {...p[lang].subtitle, text: e.target.value}}}))} className={inputStyles} />
                                            <div className="flex items-center gap-4 mt-2">
                                                <div>
                                                    <label className="block text-xs text-gray-400">Font Size</label>
                                                    <input type="text" value={heroContentForm[lang].subtitle.fontSize} onChange={e => setHeroContentForm(p => ({...p, [lang]: {...p[lang], subtitle: {...p[lang].subtitle, fontSize: e.target.value}}}))} className={`${inputStyles} w-24`} />
                                                </div>
                                                <div>
                                                    <label className="block text-xs text-gray-400">Color</label>
                                                    <input type="color" value={heroContentForm[lang].subtitle.color} onChange={e => setHeroContentForm(p => ({...p, [lang]: {...p[lang], subtitle: {...p[lang].subtitle, color: e.target.value}}}))} className="w-24 h-10 p-1 bg-gray-700 border border-gray-500 rounded-lg cursor-pointer" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                <div className="flex justify-end gap-4 pt-4">
                                    <button type="button" onClick={() => setActiveModal(null)} className={modalButtonSecondaryClasses}>{t.cancel}</button>
                                    <button type="submit" className={modalButtonPrimaryClasses}>{t.save}</button>
                                </div>
                            </form>
                        </div>
                    </Modal>
                    
                    <Modal isOpen={activeModal === 'siteSettings'} onClose={() => setActiveModal(null)} maxWidth="max-w-lg">
                        <div className="p-8 space-y-6">
                            <h2 className={modalTitleClasses}>{t.siteSettings}</h2>
                            <form onSubmit={handleSiteSettingsSave} className="space-y-4">
                                <div>
                                    <label htmlFor="analyticsId" className="block text-sm font-medium text-gray-700 dark:text-gray-300">{t.analyticsId}</label>
                                    <input type="text" id="analyticsId" value={siteSettingsForm.analyticsId} onChange={e => setSiteSettingsForm({analyticsId: e.target.value})} className={inputStyles} />
                                </div>
                                <button type="submit" className={modalButtonPrimaryClasses}>{t.save}</button>
                            </form>
                        </div>
                    </Modal>

                    <Modal isOpen={activeModal === 'introImage'} onClose={() => setActiveModal(null)} maxWidth="max-w-2xl">
                        <div className="p-8 space-y-6">
                            <h2 className={modalTitleClasses}>{t.manageIntroImages}</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {[1, 2].map(num => (
                                    <div key={num}>
                                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Image {num}</label>
                                        <img src={introImages[`image${num}`]} alt={`Intro ${num}`} className="rounded-lg mb-2 w-full h-auto object-cover"/>
                                        <input type="file" onChange={e => setIntroImageFiles(p => ({...p, [`file${num}`]: e.target.files[0]}))} accept="image/*" className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-200 dark:hover:file:bg-blue-800"/>
                                        <button onClick={() => handleDeleteIntroImage(num)} className="mt-2 w-full text-sm text-red-500 hover:text-red-700">{t.delete}</button>
                                    </div>
                                ))}
                            </div>
                            <div className="flex justify-end gap-4 pt-4">
                                <button type="button" onClick={() => setActiveModal(null)} className={modalButtonSecondaryClasses}>{t.cancel}</button>
                                <button type="button" onClick={handleSaveIntroImages} className={modalButtonPrimaryClasses}>{t.save}</button>
                            </div>
                        </div>
                    </Modal>

                    <Modal isOpen={activeModal === 'linkManager'} onClose={() => setActiveModal(null)} maxWidth="max-w-3xl">
                        <div className="p-8 space-y-6">
                            <div className="flex justify-between items-center">
                                <h2 className={modalTitleClasses}>{t.manageLinks}</h2>
                                <button onClick={() => openLinkForm(null)} className="px-4 py-2 bg-dark-green text-white rounded-lg font-semibold hover:bg-plant-green dark:bg-coral-primary dark:hover:bg-coral-secondary">{t.addLink}</button>
                            </div>
                            <div className="space-y-2 max-h-96 overflow-y-auto pr-2">
                                {linkItems.map(item => (
                                    <div key={item.id} className="flex justify-between items-center p-3 bg-gray-100 dark:bg-gray-700 rounded">
                                        <div className="truncate pr-4">
                                            <p className="font-semibold">{item.title}</p>
                                            <p className="text-sm text-gray-500 dark:text-gray-400 truncate">{item.description}</p>
                                        </div>
                                        <div className="flex-shrink-0 flex gap-2">
                                            <button onClick={() => openLinkForm(item)} className="text-blue-500 hover:text-blue-700"><i className="fas fa-edit"></i></button>
                                            <button onClick={() => handleDeleteLink(item.id)} className="text-red-500 hover:text-red-700"><i className="fas fa-trash"></i></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </Modal>

                    <Modal isOpen={activeModal === 'linkForm'} onClose={() => { setActiveModal('linkManager'); setEditingLink(null); }} maxWidth="max-w-lg">
                        <div className="p-8 space-y-6">
                            <h2 className={modalTitleClasses}>{editingLink ? t.editLink : t.addLink}</h2>
                            <form onSubmit={handleLinkSave} className="space-y-4">
                                <input type="text" value={linkForm.title} onChange={e => setLinkForm(p => ({...p, title: e.target.value}))} placeholder={t.linkTitle} required className={inputStyles} />
                                <textarea value={linkForm.description} onChange={e => setLinkForm(p => ({...p, description: e.target.value}))} placeholder={t.linkDescription} required rows="3" className={textareaStyles}></textarea>
                                <select value={linkForm.type} onChange={e => setLinkForm(p => ({...p, type: e.target.value}))} className={inputStyles}>
                                    <option value="link">Link</option>
                                    <option value="youtube">YouTube</option>
                                </select>
                                <input type="text" value={linkForm.url} onChange={e => setLinkForm(p => ({...p, url: e.target.value}))} placeholder={linkForm.type === 'youtube' ? t.youtubeVideoId : t.linkUrl} required className={inputStyles} />
                                <div className="flex justify-end gap-4 pt-4">
                                    <button type="button" onClick={() => { setActiveModal('linkManager'); setEditingLink(null); }} className={modalButtonSecondaryClasses}>{t.cancel}</button>
                                    <button type="submit" className={modalButtonPrimaryClasses}>{t.save}</button>
                                </div>
                            </form>
                        </div>
                    </Modal>

                    <Modal isOpen={activeModal === 'mediaManager'} onClose={() => setActiveModal(null)} maxWidth="max-w-3xl">
                        <div className="p-8 space-y-6">
                            <div className="flex justify-between items-center">
                                <h2 className={modalTitleClasses}>{t.manageMedia}</h2>
                                <button onClick={() => openMediaForm(null)} className="px-4 py-2 bg-dark-green text-white rounded-lg font-semibold hover:bg-plant-green dark:bg-coral-primary dark:hover:bg-coral-secondary">{t.addMedia}</button>
                            </div>
                            <div className="space-y-2 max-h-96 overflow-y-auto pr-2">
                                {mediaItems.map(item => (
                                    <div key={item.id} className="flex justify-between items-center p-3 bg-gray-100 dark:bg-gray-700 rounded">
                                        <div className="truncate pr-4">
                                            <p className="font-semibold">{item.title}</p>
                                            <p className="text-sm text-gray-500 dark:text-gray-400">{item.type}</p>
                                        </div>
                                        <div className="flex-shrink-0 flex gap-2">
                                            <button onClick={() => openMediaForm(item)} className="text-blue-500 hover:text-blue-700"><i className="fas fa-edit"></i></button>
                                            <button onClick={() => handleDeleteMedia(item.id)} className="text-red-500 hover:text-red-700"><i className="fas fa-trash"></i></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </Modal>

                    <Modal isOpen={activeModal === 'mediaForm'} onClose={() => { setActiveModal('mediaManager'); setEditingMedia(null); }} maxWidth="max-w-lg">
                        <div className="p-8 space-y-6">
                            <h2 className={modalTitleClasses}>{editingMedia ? t.editMedia : t.addMedia}</h2>
                            <form onSubmit={handleMediaSave} className="space-y-4">
                                <input type="text" value={mediaForm.title} onChange={e => setMediaForm(p => ({...p, title: e.target.value}))} placeholder={t.mediaTitle} required className={inputStyles} />
                                <textarea value={mediaForm.description} onChange={e => setMediaForm(p => ({...p, description: e.target.value}))} placeholder={t.mediaDescription} required rows="3" className={textareaStyles}></textarea>
                                <select value={mediaForm.type} onChange={e => setMediaForm(p => ({...p, type: e.target.value}))} className={inputStyles}>
                                    <option value="video">Video</option>
                                    <option value="audio">Audio</option>
                                </select>
                                <div>
                                    <input type="file" onChange={e => setMediaForm(p => ({...p, file: e.target.files[0]}))} accept="video/*,audio/*" className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-200 dark:hover:file:bg-blue-800"/>
                                    {editingMedia && mediaForm.url && <p className="text-xs mt-2 text-gray-500">Current file is preserved unless a new one is uploaded.</p>}
                                </div>
                                <div className="flex justify-end gap-4 pt-4">
                                    <button type="button" onClick={() => { setActiveModal('mediaManager'); setEditingMedia(null); }} className={modalButtonSecondaryClasses}>{t.cancel}</button>
                                    <button type="submit" className={modalButtonPrimaryClasses}>{t.save}</button>
                                </div>
                            </form>
                        </div>
                    </Modal>

                    <Modal isOpen={activeModal === 'postForm'} onClose={() => setActiveModal(null)} maxWidth="max-w-4xl">
                        <div className="p-8 space-y-6 overflow-y-auto">
                            <h2 className={modalTitleClasses}>{editingArticle ? t.edit : t.newPost}</h2>
                            <form onSubmit={handlePostSave} className="space-y-4">
                                <select value={postForm.category} onChange={e => setPostForm(p => ({...p, category: e.target.value}))} required className={inputStyles}>
                                    <option value="">{t.selectCategory}</option>
                                    {categories.map(c => <option key={c.id} value={c.id}>{c.translations[currentLanguage] || c.translations.ko}</option>)}
                                </select>
                                <input type="text" value={postForm.tags} onChange={e => setPostForm(p => ({...p, tags: e.target.value}))} placeholder={`${t.tags} (쉼표로 구분)`} className={inputStyles} />
                                <div>
                                    <label className={modalSectionTitleClasses}>{t.featuredImage}</label>
                                    <input type="file" onChange={handleFeaturedImageChange} accept="image/*" className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-200 dark:hover:file:bg-blue-800"/>
                                    {postForm.featuredImage && (
                                        <div className="mt-2 relative w-40">
                                            <img src={postForm.featuredImage} alt="Featured preview" className="h-auto w-full rounded-lg"/>
                                            <button type="button" onClick={handleDeleteFeaturedImage} className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center">&times;</button>
                                        </div>
                                    )}
                                </div>
                                {['ko', 'en', 'vn'].map(lang => (
                                    <div key={lang} className="p-4 border rounded-lg dark:border-gray-600">
                                        <h3 className="font-bold mb-2 text-white">{lang.toUpperCase()}</h3>
                                        <input type="text" value={postForm.translations[lang].title} onChange={e => setPostForm(p => ({...p, translations: {...p.translations, [lang]: {...p.translations[lang], title: e.target.value}}}))} placeholder={`${t.galleryTitle} (${lang})`} className={`${inputStyles} mb-2`} />
                                        <QuillEditor value={postForm.translations[lang].content} onChange={content => setPostForm(p => ({...p, translations: {...p.translations, [lang]: {...p.translations[lang], content}}}))} placeholder={`Content (${lang})`} />
                                    </div>
                                ))}
                                <div className="flex justify-end gap-4 pt-4">
                                    <button type="button" onClick={() => setActiveModal(null)} className={modalButtonSecondaryClasses}>{t.cancel}</button>
                                    <button type="submit" className={modalButtonPrimaryClasses}>{t.save}</button>
                                </div>
                            </form>
                        </div>
                    </Modal>

                    <Modal isOpen={activeModal === 'searchResults'} onClose={() => setActiveModal(null)} maxWidth="max-w-3xl">
                        <div className="flex justify-between items-center p-5 border-b dark:border-gray-700">
                            <h2 className={modalTitleClasses}>{t.searchResults}</h2>
                            <button onClick={() => setActiveModal(null)} className="text-gray-400 hover:text-gray-800 dark:hover:text-white"><i className="fas fa-times"></i></button>
                        </div>
                        <div className="p-8 overflow-y-auto">
                            {!searchResults || (searchResults.articles.length === 0 && searchResults.media.length === 0 && searchResults.links.length === 0) ? (
                                <p className="dark:text-gray-300">{t.noResultsFound}</p>
                            ) : (
                                <div className="space-y-6">
                                    {searchResults.articles.length > 0 && (
                                        <div>
                                            <h3 className={modalSectionTitleClasses}>{t.galleryTitle}</h3>
                                            {searchResults.articles.map(a => <div key={a.id} className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer" onClick={() => { setSelectedArticle(a); setActiveModal(null); }}>{(a.translations[currentLanguage] || a.translations.ko).title}</div>)}
                                        </div>
                                    )}
                                    {searchResults.media.length > 0 && (
                                        <div>
                                            <h3 className={modalSectionTitleClasses}>{t.mediaLibrary}</h3>
                                            {searchResults.media.map(m => <div key={m.id} className="p-2">{m.title}</div>)}
                                        </div>
                                    )}
                                     {searchResults.links.length > 0 && (
                                        <div>
                                            <h3 className={modalSectionTitleClasses}>{t.linkLibrary}</h3>
                                            {searchResults.links.map(l => <div key={l.id} className="p-2"><a href={l.url} target="_blank" rel="noopener noreferrer" className="text-blue-500 hover:underline">{l.title}</a></div>)}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </Modal>
                    
                    <ConfirmModal 
                        isOpen={!!confirmProps}
                        onClose={() => setConfirmProps(null)}
                        onConfirm={() => { confirmProps?.onConfirm(); }}
                        title={confirmProps?.title || ''}
                        message={confirmProps?.message || ''}
                        confirmText={t.delete}
                        cancelText={t.cancel}
                    />

                    {selectedArticle && (
                         <PopupModal 
                            article={selectedArticle} 
                            currentLanguage={currentLanguage} 
                            onClose={() => setSelectedArticle(null)}
                            onAddComment={handleAddComment}
                            onAddReply={handleAddReply}
                            t={t}
                            showToast={showToast}
                        />
                    )}

                    <div id="toast-container">
                        {toasts.map(toast => (
                            <Toast key={toast.id} toast={toast} onDismiss={id => setToasts(ts => ts.filter(t => t.id !== id))} />
                        ))}
                    </div>
                </div>
            );
        };

        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(<App />);

    </script>
</body>
</html>
